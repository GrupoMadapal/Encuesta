<?xml version="1.0" encoding="utf-8" ?>
<sqlMap namespace="LineItem"
xmlns="http://ibatis.apache.org/mapping"
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" >
  <alias>
    <typeAlias alias="DQ_Ventas" type="Poleo.Objects.DQ_Ventas" />
    <typeAlias alias="DQ_VentasFinder" type="Poleo.Objects.DQ_VentasFinder" />
    <typeAlias alias="InfoTiempoReal" type="Poleo.Objects.InfoTiempoReal" />
    <typeAlias alias="DQ_VentasArticulos" type="Poleo.Objects.DQ_VentasArticulos" />
	<typeAlias alias="Contabilidad" type="Poleo.Objects.Contabilidad" />
  </alias>
  <statements>
    
    <select id="selectDQVentas" resultClass="DQ_Ventas" parameterClass="DQ_VentasFinder">
     <!-- declare @ns varchar(2) = #Sucursal#
      declare @datein date = #fechaIni#
      declare @deteend date = #FechaEnd#

      DECLARE @PASTEL TABLE
      (
      CODARTICULO VARCHAR(50)
      )
      DECLARE @PASTEL2 TABLE
      (
      CODARTICULO VARCHAR(50)
      )
      INSERT @PASTEL
      SELECT CODARTICULO FROM [BD1].[dbo].ARTICULOS
      WHERE DPTO ='1800' AND SECCION  in ('1801','1802','1803','1804')
      INSERT @PASTEL2
      SELECT CODARTICULO FROM [Dairyqueen].[dbo].ARTICULOS
      WHERE DPTO ='1100' AND SECCION  in ('1101','1102','1103','1104')

      DECLARE @RAPPI TABLE
      (
      FO VARCHAR(2),
      FECHA DATETIME,
      TOTALBRUTO DECIMAL(10,2)
      )
      INSERT @RAPPI
      SELECT FO, FECHA ,ISNULL(SUM(TOTALBRUTO),0) FROM [BD1].[dbo].ALBVENTACAB
      WHERE (CODCLIENTE = '839' OR CODCLIENTE = '841' OR CODCLIENTE = '852') AND FECHA BETWEEN @datein AND @deteend AND FO = @ns--> 
      <!-- (Rappi = 839, 841)....  (uber = 852)--> 
      <!--GROUP BY FECHA, FO
      UNION
      SELECT FO, FECHA ,ISNULL(SUM(TOTALBRUTO),0) FROM [Dairyqueen].[dbo].ALBVENTACAB
      WHERE (CODCLIENTE = '1' OR CODCLIENTE = '3' OR CODCLIENTE = '4' OR CODCLIENTE = '6') AND FECHA BETWEEN @datein AND @deteend AND FO = @ns--> 
       <!-- (Rappi = 1)....  (uber = 3)--> 
     <!-- GROUP BY FECHA, FO

      DECLARE @VENTAS TABLE
      (
      SUCURSAL VARCHAR(2),
      FECHA DATETIME,
      VENTASREALES DECIMAL(10,2),
      ORDENES INT,
      VENTASTOTALES DECIMAL(10,2), /*Added by  Hector Sanchez - 20160623*/
      UTILIZADOIDEAL DECIMAL(10,2), /*Added by  Hector Sanchez - 20160623*/
      VENTASRAPPI DECIMAL(10,2)
      )

      INSERT @VENTAS
      SELECT
      SUBSTRING(NUMSERIE,1,2) AS SUCURSAL,
      FECHA,
      SUM(TOTALBRUTO) AS VENTASREALES,
      SUM( CASE WHEN TOTALNETO>0 then 1
      when TOTALNETO=0 then -1 ELSE -2 END) AS ORDENES,
      SUM(TOTALNETO) AS VENTASTOTALES, /*Added by  Hector Sanchez - 20160623*/
      SUM(TOTALCOSTE) AS UTILIZADOIDEAL, /*Added by  Hector Sanchez - 20160623*/
      (SELECT ISNULL(SUM(TOTALBRUTO),0) FROM @RAPPI R WHERE R.FECHA=ALBVENTACAB.FECHA ) AS VENTASRAPPI
      FROM [BD1].[dbo].ALBVENTACAB
      WHERE FECHA BETWEEN @datein AND @deteend AND NUMSERIE NOT LIKE '%I' AND SUBSTRING(NUMSERIE,1,2) like @ns
      GROUP BY SUBSTRING(NUMSERIE,1,2), FECHA
      UNION
      SELECT
      SUBSTRING(NUMSERIE,1,2) AS SUCURSAL,
      FECHA,
      SUM(TOTALBRUTO) AS VENTASREALES,
      SUM( CASE WHEN TOTALNETO>0 then 1
      when TOTALNETO=0 then -1 ELSE -2 END) AS ORDENES,
      SUM(TOTALNETO) AS VENTASTOTALES, /*Added by  Hector Sanchez - 20160623*/
      SUM(TOTALCOSTE) AS UTILIZADOIDEAL, /*Added by  Hector Sanchez - 20160623*/
      (SELECT ISNULL(SUM(TOTALBRUTO),0) FROM @RAPPI R WHERE R.FECHA=ALBVENTACAB.FECHA ) AS VENTASRAPPI
      FROM [Dairyqueen].[dbo].ALBVENTACAB
      WHERE FECHA BETWEEN @datein AND @deteend AND NUMSERIE NOT LIKE '%I' AND SUBSTRING(NUMSERIE,1,2) like @ns
      GROUP BY SUBSTRING(NUMSERIE,1,2), FECHA

      DECLARE @PASTELES TABLE
      (
      SUCURSAL VARCHAR(2),
      FECHA DATETIME,
      NUMEROPASTELES INT,
      VENTASPASTELES DECIMAL(10,2)
      )

      INSERT @PASTELES
      SELECT
      SUBSTRING(VD.NUMSERIE,1,2) AS SUCURSAL,
      VC.FECHA as hora,
      SUM(VD.UNIDADESTOTAL) AS NUMEROPASTELES,
      SUM(VD.TOTAL) AS VENTASPASTELES
      FROM  [BD1].[dbo].ALBVENTACAB VC
      INNER JOIN [BD1].[dbo].ALBVENTALIN VD ON VD.NUMSERIE = VC.NUMSERIE AND VD.NUMALBARAN = VC.NUMALBARAN
      INNER JOIN @PASTEL  ART  ON ART.CODARTICULO=VD.CODARTICULO
      WHERE
      VC.FECHA  BETWEEN @datein AND @deteend
      AND SUBSTRING(VD.NUMSERIE,1,2) LIKE @ns
      GROUP BY SUBSTRING(VD.NUMSERIE,1,2), VC.FECHA
      UNION
      SELECT
      SUBSTRING(VD.NUMSERIE,1,2) AS SUCURSAL,
      VC.FECHA as hora,
      SUM(VD.UNIDADESTOTAL) AS NUMEROPASTELES,
      SUM(VD.TOTAL) AS VENTASPASTELES
      FROM  [Dairyqueen].[dbo].ALBVENTACAB VC
      INNER JOIN [Dairyqueen].[dbo].ALBVENTALIN VD ON VD.NUMSERIE = VC.NUMSERIE AND VD.NUMALBARAN = VC.NUMALBARAN
      INNER JOIN @PASTEL2  ART  ON ART.CODARTICULO=VD.CODARTICULO
      WHERE
      VC.FECHA  BETWEEN @datein AND @deteend
      AND SUBSTRING(VD.NUMSERIE,1,2) LIKE @ns
      GROUP BY SUBSTRING(VD.NUMSERIE,1,2), VC.FECHA

      /********************************ADDED BY HECTOR SANCHEZ M. - 20160627**************************/
      /***********************************************************************************************/
      DECLARE @INVITACIONES TABLE
      (
      SUCURSAL VARCHAR(2),
      FECHA DATETIME,
      UTILIZADOINV DECIMAL(10,2)
      )

      INSERT @INVITACIONES
      SELECT
      SUBSTRING(NUMSERIE,1,2) AS SUCURSAL,
      FECHA,
      SUM(TOTALCOSTE) AS UTILIZADOINV
      FROM [BD1].[dbo].ALBVENTACAB
      WHERE FECHA BETWEEN @datein AND @deteend AND NUMSERIE LIKE '%I' AND SUBSTRING(NUMSERIE,1,2) like @ns
      GROUP BY SUBSTRING(NUMSERIE,1,2), FECHA
      UNION
      SELECT
      SUBSTRING(NUMSERIE,1,2) AS SUCURSAL,
      FECHA,
      SUM(TOTALCOSTE) AS UTILIZADOINV
      FROM [Dairyqueen].[dbo].ALBVENTACAB
      WHERE FECHA BETWEEN @datein AND @deteend AND NUMSERIE LIKE '%I' AND SUBSTRING(NUMSERIE,1,2) like @ns
      GROUP BY SUBSTRING(NUMSERIE,1,2), FECHA

      DECLARE @MERMAS TABLE
      (
      SUCURSAL VARCHAR(3),
      FECHA DATETIME,
      UTILIZADOMER DECIMAL(20,2)
      )

      INSERT @MERMAS
      SELECT
      CODALMACENDESTINO AS SUCURSAL,
      FECHA,
      CAST(SUM(PRECIO * UNIDADES) AS DECIMAL(20,2)) AS UTILIZADOMER
      FROM [BD1].[dbo].MOVIMENTS
      wHERE FECHA BETWEEN @datein AND @deteend AND CODALMACENDESTINO = @ns + 'M'
      GROUP BY CODALMACENDESTINO, FECHA
      UNION
      SELECT
      CODALMACENDESTINO AS SUCURSAL,
      FECHA,
      CAST(SUM(PRECIO * UNIDADES) AS DECIMAL(20,2)) AS UTILIZADOMER
      FROM [Dairyqueen].[dbo].MOVIMENTS
      wHERE FECHA BETWEEN @datein AND @deteend AND CODALMACENDESTINO = @ns + 'M'
      GROUP BY CODALMACENDESTINO, FECHA
      /***********************************************************************************************/

      SELECT
      V.SUCURSAL AS Sucursal,
      V.FECHA AS Fecha,
      V.VENTASREALES AS VentasReales,
      V.VENTASTOTALES as VentasTotales, /*Added by  Hector Sanchez - 20160623*/
      ISNULL(V.UTILIZADOIDEAL, 0) + ISNULL(INV.UTILIZADOINV, 0) + ISNULL(MER.UTILIZADOMER, 0) AS UtilizadoIdeal, /*Added by  Hector Sanchez - 20160623*/
      V.ORDENES AS Ordenes,
      V.VENTASRAPPI AS VentasRappi,
      P.NUMEROPASTELES AS NumeroPasteles,
      P.VENTASPASTELES AS VentasPasteles,
      /*CASE  when DATEPART(dw,V.FECHA)=1  then 7 else DATEPART(dw,V.FECHA)-1 end  AS NumDia,*/
      DATEPART(dw,V.FECHA) AS NumDia,
      DATEPART(ISO_WEEK,V.FECHA) as NumSemana
      FROM @VENTAS AS V
      LEFT JOIN  @PASTELES P ON P.SUCURSAL=V.SUCURSAL AND P.FECHA=V.FECHA
      LEFT JOIN @INVITACIONES INV ON INV.SUCURSAL = V.SUCURSAL AND INV.FECHA = V.FECHA
      LEFT JOIN @MERMAS MER ON SUBSTRING(MER.SUCURSAL,1,2) = V.SUCURSAL AND MER.FECHA = V.FECHA
      ORDER BY V.SUCURSAL,V.FECHA--> 
	
	  declare @ns varchar(2) = #Sucursal#
      declare @datein date = #fechaIni#
      declare @deteend date = #FechaEnd#

      
      DECLARE @PASTEL2 TABLE
      (
      CODARTICULO VARCHAR(50)
      )
      INSERT @PASTEL2
      SELECT CODARTICULO FROM [Dairyqueen].[dbo].ARTICULOS
      WHERE DPTO ='1100' AND SECCION  in ('1101','1102','1103','1104')

      DECLARE @RAPPI TABLE
      (
      FO VARCHAR(2),
      FECHA DATETIME,
      TOTALBRUTO DECIMAL(10,2),
	  ORDENESDOM INT
      )
      INSERT @RAPPI
      SELECT FO, FECHA ,ISNULL(SUM(TOTALBRUTO),0) 
	  ,SUM( CASE WHEN TOTALNETO>0 then 1 when TOTALNETO=0 then -1 ELSE -2 END) AS ORDENESDOM
	  FROM [Dairyqueen].[dbo].ALBVENTACAB
      WHERE (CODCLIENTE = '1' OR CODCLIENTE = '3' OR CODCLIENTE = '4' OR CODCLIENTE = '6') AND FECHA BETWEEN @datein AND @deteend AND FO = @ns
      <!-- (Rappi = 1)....  (uber = 3)--> 
      GROUP BY FECHA, FO

      DECLARE @VENTAS TABLE
      (
      SUCURSAL VARCHAR(2),
      FECHA DATETIME,
      VENTASREALES DECIMAL(10,2),
      ORDENES INT,
      VENTASTOTALES DECIMAL(10,2), /*Added by  Hector Sanchez - 20160623*/
      UTILIZADOIDEAL DECIMAL(10,2), /*Added by  Hector Sanchez - 20160623*/
      VENTASRAPPI DECIMAL(10,2)
	  ,ORDENESDOM INT
      )

      INSERT @VENTAS     
      SELECT
      SUBSTRING(NUMSERIE,1,2) AS SUCURSAL,
      FECHA,
      SUM(TOTALBRUTO) AS VENTASREALES,
      SUM( CASE WHEN TOTALNETO>0 then 1
      when TOTALNETO=0 then -1 ELSE -2 END) AS ORDENES,
      SUM(TOTALNETO) AS VENTASTOTALES, /*Added by  Hector Sanchez - 20160623*/
      SUM(TOTALCOSTE) AS UTILIZADOIDEAL, /*Added by  Hector Sanchez - 20160623*/
      (SELECT ISNULL(SUM(TOTALBRUTO),0) FROM @RAPPI R WHERE R.FECHA=ALBVENTACAB.FECHA ) AS VENTASRAPPI
	  ,(SELECT SUM(ORDENESDOM) FROM @RAPPI R WHERE R.FECHA=ALBVENTACAB.FECHA ) AS ORDENESDOM
      FROM [Dairyqueen].[dbo].ALBVENTACAB
      WHERE FECHA BETWEEN @datein AND @deteend AND NUMSERIE NOT LIKE '%I' AND SUBSTRING(NUMSERIE,1,2) like @ns
      GROUP BY SUBSTRING(NUMSERIE,1,2), FECHA

      DECLARE @PASTELES TABLE
      (
      SUCURSAL VARCHAR(2),
      FECHA DATETIME,
      NUMEROPASTELES INT,
      VENTASPASTELES DECIMAL(10,2)
      )
      INSERT @PASTELES
      SELECT
      SUBSTRING(VD.NUMSERIE,1,2) AS SUCURSAL,
      VC.FECHA as hora,
      SUM(VD.UNIDADESTOTAL) AS NUMEROPASTELES,
      SUM(VD.TOTAL) AS VENTASPASTELES
      FROM  [Dairyqueen].[dbo].ALBVENTACAB VC
      INNER JOIN [Dairyqueen].[dbo].ALBVENTALIN VD ON VD.NUMSERIE = VC.NUMSERIE AND VD.NUMALBARAN = VC.NUMALBARAN
      INNER JOIN @PASTEL2  ART  ON ART.CODARTICULO=VD.CODARTICULO
      WHERE
      VC.FECHA  BETWEEN @datein AND @deteend
      AND SUBSTRING(VD.NUMSERIE,1,2) LIKE @ns
      GROUP BY SUBSTRING(VD.NUMSERIE,1,2), VC.FECHA

      /********************************ADDED BY HECTOR SANCHEZ M. - 20160627**************************/
      /***********************************************************************************************/
      DECLARE @INVITACIONES TABLE
      (
      SUCURSAL VARCHAR(2),
      FECHA DATETIME,
      UTILIZADOINV DECIMAL(10,2)
      )
      INSERT @INVITACIONES
      SELECT
      SUBSTRING(NUMSERIE,1,2) AS SUCURSAL,
      FECHA,
      SUM(TOTALCOSTE) AS UTILIZADOINV
      FROM [Dairyqueen].[dbo].ALBVENTACAB
      WHERE FECHA BETWEEN @datein AND @deteend AND NUMSERIE LIKE '%I' AND SUBSTRING(NUMSERIE,1,2) like @ns
      GROUP BY SUBSTRING(NUMSERIE,1,2), FECHA

      DECLARE @MERMAS TABLE
      (
      SUCURSAL VARCHAR(3),
      FECHA DATETIME,
      UTILIZADOMER DECIMAL(20,2)
      )
      INSERT @MERMAS
      SELECT
      CODALMACENDESTINO AS SUCURSAL,
      FECHA,
      CAST(SUM(PRECIO * UNIDADES) AS DECIMAL(20,2)) AS UTILIZADOMER
      FROM [Dairyqueen].[dbo].MOVIMENTS
      wHERE FECHA BETWEEN @datein AND @deteend AND CODALMACENDESTINO = @ns + 'M'
      GROUP BY CODALMACENDESTINO, FECHA
      /***********************************************************************************************/

      SELECT
      V.SUCURSAL AS Sucursal,
      V.FECHA AS Fecha,
      V.VENTASREALES AS VentasReales,
      V.VENTASTOTALES as VentasTotales, /*Added by  Hector Sanchez - 20160623*/
      ISNULL(V.UTILIZADOIDEAL, 0) + ISNULL(INV.UTILIZADOINV, 0) + ISNULL(MER.UTILIZADOMER, 0) AS UtilizadoIdeal, /*Added by  Hector Sanchez - 20160623*/
      V.ORDENES AS Ordenes,
      V.VENTASRAPPI AS VentasRappi,
      P.NUMEROPASTELES AS NumeroPasteles,
      P.VENTASPASTELES AS VentasPasteles,
      /*CASE  when DATEPART(dw,V.FECHA)=1  then 7 else DATEPART(dw,V.FECHA)-1 end  AS NumDia,*/
	  v.ORDENESDOM as OrdenesDom,
      DATEPART(dw,V.FECHA) AS NumDia,
      DATEPART(ISO_WEEK,V.FECHA) as NumSemana
      FROM @VENTAS AS V
      LEFT JOIN  @PASTELES P ON P.SUCURSAL=V.SUCURSAL AND P.FECHA=V.FECHA
      LEFT JOIN @INVITACIONES INV ON INV.SUCURSAL = V.SUCURSAL AND INV.FECHA = V.FECHA
      LEFT JOIN @MERMAS MER ON SUBSTRING(MER.SUCURSAL,1,2) = V.SUCURSAL AND MER.FECHA = V.FECHA
      ORDER BY V.SUCURSAL,V.FECHA
    </select>
      
    <select id="selectDQVentasTotal" resultClass="DQ_Ventas" parameterClass="DQ_VentasFinder">
		<!-- DECLARE @PASTEL TABLE
      (
      CODARTICULO VARCHAR(50)
      )

      DECLARE @PASTEL2 TABLE
      (
      CODARTICULO VARCHAR(50)
      )
      INSERT @PASTEL
      SELECT CODARTICULO FROM [BD1].[dbo].ARTICULOS
      WHERE DPTO ='1800' AND SECCION  in ('1801','1802','1803','1804')
      INSERT @PASTEL2
      SELECT CODARTICULO FROM [Dairyqueen].[dbo].ARTICULOS
      WHERE DPTO ='1100' AND SECCION  in ('1101','1102','1103','1104')

      DECLARE @RAPPI TABLE
      (
      FO VARCHAR(2),
      FECHA DATETIME,
      TOTALBRUTO DECIMAL(10,2)
      )
      INSERT @RAPPI
      SELECT FO, FECHA ,ISNULL(SUM(TOTALBRUTO),0) FROM [BD1].[dbo].ALBVENTACAB
      WHERE (CODCLIENTE = '839' OR CODCLIENTE = '841' OR CODCLIENTE = '852') AND FECHA BETWEEN #fechaIni# AND #FechaEnd#-->
      <!-- (Rappi = 839, 841)....  (uber = 852)-->
		<!--GROUP BY FECHA, FO
      UNION
      SELECT FO, FECHA ,ISNULL(SUM(TOTALBRUTO),0) FROM [DairyQueen].[dbo].ALBVENTACAB
      WHERE (CODCLIENTE = '1' OR CODCLIENTE = '3' OR CODCLIENTE = '4' OR CODCLIENTE = '6') AND FECHA BETWEEN #fechaIni# AND #FechaEnd#-->
      <!-- (Rappi = '1' OR uber = '3') -->
		<!--GROUP BY FECHA, FO



      DECLARE @VENTAS TABLE
      (
      FECHA DATETIME,
      VENTASREALES DECIMAL(10,2),
      ORDENES INT,
      VENTASTOTALES DECIMAL(10,2), /*Added by  Hector Sanchez - 20160623*/
      UTILIZADOIDEAL DECIMAL(10,2), /*Added by  Hector Sanchez - 20160623*/
      VENTASRAPPI DECIMAL(10,2)
      )

      INSERT @VENTAS
      SELECT
      FECHA,
      SUM(TOTALBRUTO) AS VENTASREALES,
      SUM( CASE WHEN TOTALNETO>0 then 1
      when TOTALNETO=0 then -1 ELSE -2 END) AS ORDENES,
      SUM(TOTALNETO) AS VENTASTOTALES, /*Added by  Hector Sanchez - 20160623*/
      SUM(TOTALCOSTE) AS UTILIZADOIDEAL, /*Added by  Hector Sanchez - 20160623*/
      (SELECT ISNULL(SUM(TOTALBRUTO),0) FROM @RAPPI R WHERE R.FECHA=ALBVENTACAB.FECHA ) AS VENTASRAPPI
      FROM [BD1].[dbo].ALBVENTACAB
      WHERE FECHA BETWEEN #fechaIni# AND #FechaEnd# AND NUMSERIE NOT LIKE '%I'
      GROUP BY  FECHA
      UNION
      SELECT
      FECHA,
      SUM(TOTALBRUTO) AS VENTASREALES,
      SUM( CASE WHEN TOTALNETO>0 then 1
      when TOTALNETO=0 then -1 ELSE -2 END) AS ORDENES,
      SUM(TOTALNETO) AS VENTASTOTALES, /*Added by  Hector Sanchez - 20160623*/
      SUM(TOTALCOSTE) AS UTILIZADOIDEAL, /*Added by  Hector Sanchez - 20160623*/
      (SELECT ISNULL(SUM(TOTALBRUTO),0) FROM @RAPPI R WHERE R.FECHA=ALBVENTACAB.FECHA ) AS VENTASRAPPI
      FROM [DairyQueen].[dbo].ALBVENTACAB
      WHERE FECHA BETWEEN #fechaIni# AND #FechaEnd# AND NUMSERIE NOT LIKE '%I'
      GROUP BY  FECHA

      DECLARE @PASTELES TABLE
      (
      FECHA DATETIME,
      NUMEROPASTELES INT,
      VENTASPASTELES DECIMAL(10,2)
      )


      INSERT @PASTELES
      SELECT
      VC.FECHA as FECHA,
      SUM(VD.UNIDADESTOTAL) AS NUMEROPASTELES,
      SUM(VD.TOTAL) AS VENTASPASTELES
      FROM  [BD1].[dbo].ALBVENTACAB VC
      INNER JOIN [BD1].[dbo].ALBVENTALIN VD ON VD.NUMSERIE = VC.NUMSERIE AND VD.NUMALBARAN = VC.NUMALBARAN
      INNER JOIN @PASTEL  ART  ON ART.CODARTICULO=VD.CODARTICULO
      WHERE
      VC.FECHA BETWEEN #fechaIni# AND #FechaEnd#
      GROUP BY VC.FECHA
      UNION
      SELECT
      VC.FECHA as FECHA,
      SUM(VD.UNIDADESTOTAL) AS NUMEROPASTELES,
      SUM(VD.TOTAL) AS VENTASPASTELES
      FROM  [DairyQueen].[dbo].ALBVENTACAB VC
      INNER JOIN [DairyQueen].[dbo].ALBVENTALIN VD ON VD.NUMSERIE = VC.NUMSERIE AND VD.NUMALBARAN = VC.NUMALBARAN
      INNER JOIN @PASTEL2  ART  ON ART.CODARTICULO=VD.CODARTICULO
      WHERE
      VC.FECHA BETWEEN #fechaIni# AND #FechaEnd#
      GROUP BY VC.FECHA

      /********************************ADDED BY HECTOR SANCHEZ M. - 20160627**************************/
      /***********************************************************************************************/
      DECLARE @INVITACIONES TABLE
      (
      FECHA DATETIME,
      UTILIZADOINV DECIMAL(10,2)
      )

      INSERT @INVITACIONES
      SELECT
      FECHA,
      SUM(TOTALCOSTE) AS UTILIZADOINV
      FROM [BD1].[dbo].ALBVENTACAB
      WHERE FECHA BETWEEN #fechaIni# AND #FechaEnd# AND NUMSERIE LIKE '%I'
      GROUP BY FECHA
      UNION
      SELECT
      FECHA,
      SUM(TOTALCOSTE) AS UTILIZADOINV
      FROM [DairyQueen].[dbo].ALBVENTACAB
      WHERE FECHA BETWEEN #fechaIni# AND #FechaEnd# AND NUMSERIE LIKE '%I'
      GROUP BY FECHA


      DECLARE @MERMAS TABLE
      (
      FECHA DATETIME,
      UTILIZADOINV DECIMAL(20,2)
      )

      INSERT @MERMAS
      SELECT
      FECHA,
      SUM(PRECIO * UNIDADES) AS UTILIZADOMER
      FROM [BD1].[dbo].MOVIMENTS
      WHERE FECHA BETWEEN #fechaIni# AND #FechaEnd# AND CODALMACENDESTINO LIKE '%M'
      GROUP BY  FECHA
      UNION
      SELECT
      FECHA,
      SUM(PRECIO * UNIDADES) AS UTILIZADOMER
      FROM [DairyQueen].[dbo].MOVIMENTS
      WHERE FECHA BETWEEN #fechaIni# AND #FechaEnd# AND CODALMACENDESTINO LIKE '%M'
      GROUP BY  FECHA
      /***********************************************************************************************/

      SELECT

      V.FECHA AS Fecha,
      V.VENTASREALES AS VentasReales,
      V.VENTASTOTALES as VentasTotales, /*Added by  Hector Sanchez - 20160623*/
      ISNULL(V.UTILIZADOIDEAL, 0) + ISNULL(INV.UTILIZADOINV, 0) + ISNULL(MER.UTILIZADOINV, 0) AS UtilizadoIdeal, /*Added by  Hector Sanchez - 20160623*/
      V.ORDENES AS Ordenes,
      V.VENTASRAPPI AS VentasRappi,
      P.NUMEROPASTELES AS NumeroPasteles,
      P.VENTASPASTELES AS VentasPasteles,
      /*CASE  when DATEPART(dw,p.FECHA)=1  then 7 else DATEPART(dw,V.FECHA)-1 end  AS NumDia,*/
      DATEPART(dw,p.FECHA) AS NumDia,
      DATEPART(ISO_WEEK,V.FECHA) as NumSemana
      FROM @VENTAS AS V
      LEFT JOIN  @PASTELES P ON  P.FECHA=V.FECHA
      LEFT JOIN @INVITACIONES INV ON INV.FECHA = V.FECHA
      LEFT JOIN @MERMAS MER ON MER.FECHA = V.FECHA
      ORDER BY V.FECHA-->
		DECLARE @PASTEL2 TABLE
		(
		CODARTICULO VARCHAR(50)
		)
		INSERT @PASTEL2
		SELECT CODARTICULO FROM [Dairyqueen].[dbo].ARTICULOS
		WHERE DPTO ='1100' AND SECCION  in ('1101','1102','1103','1104')

		DECLARE @RAPPI TABLE
		(
		FO VARCHAR(2),
		FECHA DATETIME,
		TOTALBRUTO DECIMAL(10,2),
		ORDENESDOM INT
		)
		INSERT @RAPPI
		SELECT FO, FECHA ,ISNULL(SUM(TOTALBRUTO),0)
		,SUM( CASE WHEN TOTALNETO>0 then 1 when TOTALNETO=0 then -1 ELSE -2 END) AS ORDENESDOM
		FROM [DairyQueen].[dbo].ALBVENTACAB
		WHERE (CODCLIENTE = '1' OR CODCLIENTE = '3' OR CODCLIENTE = '4' OR CODCLIENTE = '6') AND FECHA BETWEEN #fechaIni# AND #FechaEnd#
		<!-- (Rappi = '1' OR uber = '3') -->
		GROUP BY FECHA, FO

		DECLARE @VENTAS TABLE
		(
		FECHA DATETIME,
		VENTASREALES DECIMAL(10,2),
		ORDENES INT,
		VENTASTOTALES DECIMAL(10,2), /*Added by  Hector Sanchez - 20160623*/
		UTILIZADOIDEAL DECIMAL(10,2), /*Added by  Hector Sanchez - 20160623*/
		VENTASRAPPI DECIMAL(10,2),
		ORDENESDOM INT
		)
		INSERT @VENTAS
		SELECT
		FECHA,
		SUM(TOTALBRUTO) AS VENTASREALES,
		SUM( CASE WHEN TOTALNETO>0 then 1
		when TOTALNETO=0 then -1 ELSE -2 END) AS ORDENES,
		SUM(TOTALNETO) AS VENTASTOTALES, /*Added by  Hector Sanchez - 20160623*/
		SUM(TOTALCOSTE) AS UTILIZADOIDEAL, /*Added by  Hector Sanchez - 20160623*/
		(SELECT ISNULL(SUM(TOTALBRUTO),0) FROM @RAPPI R WHERE R.FECHA=ALBVENTACAB.FECHA ) AS VENTASRAPPI,
		(SELECT SUM(ORDENESDOM) FROM @RAPPI R WHERE R.FECHA=ALBVENTACAB.FECHA ) AS ORDENESDOM
		FROM [DairyQueen].[dbo].ALBVENTACAB
		WHERE FECHA BETWEEN #fechaIni# AND #FechaEnd# AND NUMSERIE NOT LIKE '%I'
		GROUP BY  FECHA

		DECLARE @PASTELES TABLE
		(
		FECHA DATETIME,
		NUMEROPASTELES INT,
		VENTASPASTELES DECIMAL(10,2)
		)
		INSERT @PASTELES
		SELECT
		VC.FECHA as FECHA,
		SUM(VD.UNIDADESTOTAL) AS NUMEROPASTELES,
		SUM(VD.TOTAL) AS VENTASPASTELES
		FROM  [DairyQueen].[dbo].ALBVENTACAB VC
		INNER JOIN [DairyQueen].[dbo].ALBVENTALIN VD ON VD.NUMSERIE = VC.NUMSERIE AND VD.NUMALBARAN = VC.NUMALBARAN
		INNER JOIN @PASTEL2  ART  ON ART.CODARTICULO=VD.CODARTICULO
		WHERE
		VC.FECHA BETWEEN #fechaIni# AND #FechaEnd#
		GROUP BY VC.FECHA

		/********************************ADDED BY HECTOR SANCHEZ M. - 20160627**************************/
		/***********************************************************************************************/
		DECLARE @INVITACIONES TABLE
		(
		FECHA DATETIME,
		UTILIZADOINV DECIMAL(10,2)
		)
		INSERT @INVITACIONES
		SELECT
		FECHA,
		SUM(TOTALCOSTE) AS UTILIZADOINV
		FROM [DairyQueen].[dbo].ALBVENTACAB
		WHERE FECHA BETWEEN #fechaIni# AND #FechaEnd# AND NUMSERIE LIKE '%I'
		GROUP BY FECHA


		DECLARE @MERMAS TABLE
		(
		FECHA DATETIME,
		UTILIZADOINV DECIMAL(20,2)
		)
		INSERT @MERMAS
		SELECT
		FECHA,
		SUM(PRECIO * UNIDADES) AS UTILIZADOMER
		FROM [DairyQueen].[dbo].MOVIMENTS
		WHERE FECHA BETWEEN #fechaIni# AND #FechaEnd# AND CODALMACENDESTINO LIKE '%M'
		GROUP BY  FECHA
		/***********************************************************************************************/

		SELECT
		V.FECHA AS Fecha,
		V.VENTASREALES AS VentasReales,
		V.VENTASTOTALES as VentasTotales, /*Added by  Hector Sanchez - 20160623*/
		ISNULL(V.UTILIZADOIDEAL, 0) + ISNULL(INV.UTILIZADOINV, 0) + ISNULL(MER.UTILIZADOINV, 0) AS UtilizadoIdeal, /*Added by  Hector Sanchez - 20160623*/
		V.ORDENES AS Ordenes,
		V.VENTASRAPPI AS VentasRappi,
		P.NUMEROPASTELES AS NumeroPasteles,
		P.VENTASPASTELES AS VentasPasteles
		/*CASE  when DATEPART(dw,p.FECHA)=1  then 7 else DATEPART(dw,V.FECHA)-1 end  AS NumDia,*/
		,v.ORDENESDOM as OrdenesDom,
		DATEPART(dw,p.FECHA) AS NumDia,
		DATEPART(ISO_WEEK,V.FECHA) as NumSemana
		FROM @VENTAS AS V
		LEFT JOIN  @PASTELES P ON  P.FECHA=V.FECHA
		LEFT JOIN @INVITACIONES INV ON INV.FECHA = V.FECHA
		LEFT JOIN @MERMAS MER ON MER.FECHA = V.FECHA
		ORDER BY V.FECHA


	</select>

    <select id="SelectVentasDQOnLine" resultClass="InfoTiempoReal" parameterClass="InfoTiempoReal">
      <!--SELECT
      CAST(SUM(TOTALBRUTO) AS DECIMAL(12,2)) AS VentasReales,
      CAST(SUM(TOTALNETO) AS DECIMAL(12,2)) AS VentasTotales
      FROM ALBVENTACAB
      WHERE FECHA = #Fecha# AND NUMSERIE NOT LIKE '%I'AND NUMSERIE NOT LIKE '%F'-->

      DECLARE @PASTEL TABLE
      (
      CODARTICULO VARCHAR(50)
      )

      INSERT @PASTEL
      SELECT CODARTICULO FROM ARTICULOS
      WHERE DPTO ='1100' AND SECCION  in ('1101','1102','1103','1104')

      DECLARE @PASTELES TABLE
      (
      FECHA DATETIME,
      NUMEROPASTELES INT
      )

      INSERT @PASTELES
      SELECT
      convert(DATE, VD.HORA) AS FECHA ,
      SUM(VD.UNIDADESTOTAL) AS NUMEROPASTELES
      FROM ALBVENTALIN VD
      INNER JOIN @PASTEL ART ON ART.CODARTICULO = VD.CODARTICULO
      WHERE DATEADD(DD, 0, DATEDIFF(DD, 0, VD.HORA)) = #Fecha#
      GROUP BY convert(date, VD.HORA)

      DECLARE @VENTAS TABLE
      (
      Fecha DATE,
      VentasReales DECIMAL(12, 2),
      VentasTotales DECIMAL(12, 2),
      Ordenes DECIMAL(12, 2)
      )

      INSERT @VENTAS
      SELECT
      FECHA,
      CAST(SUM(TOTALBRUTO) AS DECIMAL(12,2)) AS VentasReales,
      CAST(SUM(TOTALNETO) AS DECIMAL(12,2)) AS VentasTotales,
      SUM( CASE WHEN TOTALNETO > 0 THEN 1
      WHEN TOTALNETO=0 then -1 ELSE -2 END) AS Ordenes
      FROM ALBVENTACAB
      WHERE FECHA = #Fecha# AND NUMSERIE NOT LIKE '%I'AND NUMSERIE NOT LIKE '%F'
      GROUP BY FECHA

      SELECT
      V.VentasReales,
      V.VentasTotales,
      V.Ordenes,
      P.NUMEROPASTELES AS Pasteles
      FROM @VENTAS V
      INNER JOIN @PASTELES P ON V.Fecha = P.FECHA
    </select>

    <select id="SelectVentasDQOnLineTienda" resultClass="InfoTiempoReal" parameterClass="InfoTiempoReal">
      <!--SELECT
      CAST(SUM(TOTALBRUTO) AS DECIMAL(12,2)) AS VentasReales,
      CAST(SUM(TOTALNETO) AS DECIMAL(12,2)) AS VentasTotales,
      SUBSTRING(NUMSERIE,1,2) AS NombreTienda,
      DESCRIPCION AS NumTienda
      FROM ALBVENTACAB
      INNER JOIN SERIES ON SUBSTRING(ALBVENTACAB.NUMSERIE,1,2) = SERIES.SERIE
      WHERE FECHA = #Fecha# AND NUMSERIE NOT LIKE '%I'AND NUMSERIE NOT LIKE '%F'
      <iterate prepend=" AND SUBSTRING(ALBVENTACAB.NUMSERIE,1,2) IN " property="LstNumTienda" open="(" close=")" conjunction=",">
          #LstNumTienda[]#
      </iterate>
      GROUP BY SUBSTRING(NUMSERIE,1,2), FECHA, DESCRIPCION-->
      DECLARE @PASTEL TABLE
      (
      CODARTICULO VARCHAR(50)
      )

      INSERT @PASTEL
      SELECT CODARTICULO FROM ARTICULOS
      WHERE DPTO ='1100' AND SECCION  in ('1101','1102','1103','1104')

      DECLARE @PASTELES TABLE
      (
      NumTienda VARCHAR(14),
      FECHA DATETIME,
      NUMEROPASTELES INT
      )

      INSERT @PASTELES
      SELECT
      SUBSTRING(VD.NUMSERIE,1,2) AS NumTienda,
      convert(DATE, VD.HORA) AS FECHA ,
      SUM(VD.UNIDADESTOTAL) AS NUMEROPASTELES
      FROM ALBVENTALIN VD
      INNER JOIN @PASTEL ART ON ART.CODARTICULO = VD.CODARTICULO
      WHERE DATEADD(DD, 0, DATEDIFF(DD, 0, VD.HORA)) = #Fecha#
      GROUP BY convert(date, VD.HORA), SUBSTRING(VD.NUMSERIE,1,2)

      DECLARE @VENTAS TABLE
      (
      Fecha DATE,
      VentasReales DECIMAL(12, 2),
      VentasTotales DECIMAL(12, 2),
      Ordenes DECIMAL(12, 2),
      NumTienda VARCHAR(14),
      NombreTienda VARCHAR(50)
      )

      INSERT @VENTAS
      SELECT
      FECHA,
      CAST(SUM(TOTALBRUTO) AS DECIMAL(12,2)) AS VentasReales,
      CAST(SUM(TOTALNETO) AS DECIMAL(12,2)) AS VentasTotales,
      SUM( CASE WHEN TOTALNETO > 0 THEN 1
      WHEN TOTALNETO=0 then -1 ELSE -2 END) AS Ordenes,
      SUBSTRING(NUMSERIE,1,2) AS NumTienda,
      DESCRIPCION AS NombreTienda
      FROM ALBVENTACAB
      INNER JOIN SERIES ON SUBSTRING(ALBVENTACAB.NUMSERIE,1,2) = SERIES.SERIE
      WHERE FECHA = #Fecha# AND NUMSERIE NOT LIKE '%I'AND NUMSERIE NOT LIKE '%F'
      <iterate prepend=" AND SUBSTRING(ALBVENTACAB.NUMSERIE,1,2) IN " property="LstNumTienda" open="(" close=")" conjunction=",">
          #LstNumTienda[]#
      </iterate>
      GROUP BY SUBSTRING(NUMSERIE,1,2), FECHA, DESCRIPCION

      SELECT
      V.VentasReales,
      V.VentasTotales,
      V.Ordenes,
      P.NUMEROPASTELES AS Pasteles,
	    V.NombreTienda,
      V.NumTienda
      FROM @VENTAS V
      LEFT JOIN @PASTELES P ON V.NumTienda = P.NumTienda
    </select>
  
    <!--<select id="SelectVentasDQArticulos" resultClass="DQ_Ventas" parameterClass="DQ_VentasFinder">
      SELECT
      'Artic' AS Articulo,
      CAST(SUM(ALBVENTALIN.TOTAL) AS DECIMAL(12,2)) AS VentasTotales
      FROM ALBVENTALIN
      INNER JOIN ARTICULOS ON ALBVENTALIN.CODARTICULO = ARTICULOS.CODARTICULO
      WHERE HORA BETWEEN #FechaIni# AND DATEADD(DAY,1,#FechaEnd#) AND DPTO = '1700'
      UNION
      SELECT
      'Pasteles' AS Articulo,
      CAST(SUM(ALBVENTALIN.TOTAL) AS DECIMAL(12,2)) AS VentasTotales
      FROM ALBVENTALIN
      INNER JOIN ARTICULOS ON ALBVENTALIN.CODARTICULO = ARTICULOS.CODARTICULO
      WHERE HORA BETWEEN #FechaIni# AND DATEADD(DAY,1,#FechaEnd#) AND DPTO = '1800' AND SECCION IN ('1801','1802','1803','1804')
      UNION
      SELECT
      'Otros' AS Articulo,
      CAST(SUM(ALBVENTALIN.TOTAL) AS DECIMAL(12,2)) AS VentasTotales
      FROM ALBVENTALIN
      INNER JOIN ARTICULOS ON ALBVENTALIN.CODARTICULO = ARTICULOS.CODARTICULO
      WHERE HORA BETWEEN #FechaIni# AND DATEADD(DAY,1,#FechaEnd#) AND DPTO NOT IN ('1700','1800')
    </select>-->

    <select id="SelectVentasArtic" resultClass="DQ_Ventas" parameterClass="DQ_VentasFinder">
      <!-- SELECT
      'Artic' AS Articulo,
      CAST(SUM(ALBVENTALIN.TOTAL) AS DECIMAL(12,2)) AS VentasTotales
      FROM ALBVENTALIN
      INNER JOIN albventacab on (ALBVENTALIN.NUMALBARAN = ALBVENTACAB.NUMALBARAN)
      INNER JOIN articulos on (ALBVENTALIN.CODARTICULO = ARTICULOS.CODARTICULO)
      where albventacab.fecha BETWEEN #FechaIni# AND #FechaEnd# and ARTICULOS.DPTO = '1700' and albventacab.NUMSERIE=ALBVENTALIN.NUMSERIE  -->
      DECLARE @Arctic TABLE
      (
      Articulo VARCHAR(10),
      VentasTotales DECIMAL(12,2)
      )
      INSERT @Arctic

      SELECT
      'Artic' AS Articulo,
      CAST(SUM(ALBVENTALIN.TOTAL) AS DECIMAL(12,2)) AS VentasTotales
      FROM [BD1].[dbo].ALBVENTALIN
      INNER JOIN [BD1].[dbo].albventacab on ([BD1].[dbo].ALBVENTALIN.NUMALBARAN = [BD1].[dbo].ALBVENTACAB.NUMALBARAN)
      INNER JOIN [BD1].[dbo].articulos on ([BD1].[dbo].ALBVENTALIN.CODARTICULO = [BD1].[dbo].ARTICULOS.CODARTICULO)
      where [BD1].[dbo].albventacab.fecha BETWEEN #FechaIni# AND #FechaEnd# and [BD1].[dbo].ARTICULOS.DPTO = '1700'
      and [BD1].[dbo].albventacab.NUMSERIE=[BD1].[dbo].ALBVENTALIN.NUMSERIE
              UNION
      SELECT 'Artic' AS Articulo,
      CAST(SUM([DairyQueen].[dbo].ALBVENTALIN.TOTAL) AS DECIMAL(12,2)) AS VentasTotales
      FROM [DairyQueen].[dbo].ALBVENTALIN
      INNER JOIN [DairyQueen].[dbo].albventacab on ([DairyQueen].[dbo].ALBVENTALIN.NUMALBARAN = [DairyQueen].[dbo].ALBVENTACAB.NUMALBARAN)
      INNER JOIN [DairyQueen].[dbo].articulos on ([DairyQueen].[dbo].ALBVENTALIN.CODARTICULO = [DairyQueen].[dbo].ARTICULOS.CODARTICULO)
      where [DairyQueen].[dbo].albventacab.fecha BETWEEN #FechaIni# AND #FechaEnd# and [DairyQueen].[dbo].ARTICULOS.DPTO = '900'
      and [DairyQueen].[dbo].albventacab.NUMSERIE=[DairyQueen].[dbo].ALBVENTALIN.NUMSERIE

      SELECT Articulo, SUM(VentasTotales) AS VentasTotales
      FROM @Arctic GROUP BY Articulo
    </select>

    <select id="SelectVentasPasteles" resultClass="DQ_Ventas" parameterClass="DQ_VentasFinder">
      <!-- SELECT 'Pasteles' AS Articulo,
      CAST(SUM(ALBVENTALIN.TOTAL) AS DECIMAL(12,2)) AS VentasTotales
      FROM ALBVENTALIN
      INNER JOIN albventacab on (ALBVENTALIN.NUMALBARAN = ALBVENTACAB.NUMALBARAN)
      INNER JOIN articulos on (ALBVENTALIN.CODARTICULO = ARTICULOS.CODARTICULO)
      where albventacab.fecha BETWEEN #FechaIni#  AND  #FechaEnd# and ARTICULOS.DPTO = '1800' AND SECCION IN ('1801','1802','1803','1804') 
      and albventacab.NUMSERIE=ALBVENTALIN.NUMSERIE -->
      DECLARE @Pasteles TABLE
      (
      Articulo VARCHAR(10),
      VentasTotales DECIMAL(12,2)
      )
      INSERT @Pasteles

      SELECT
      'Pasteles' AS Articulo,
      CAST(SUM([BD1].[dbo].ALBVENTALIN.TOTAL) AS DECIMAL(12,2)) AS VentasTotales
      FROM [BD1].[dbo].ALBVENTALIN
      INNER JOIN [BD1].[dbo].albventacab on ([BD1].[dbo].ALBVENTALIN.NUMALBARAN = [BD1].[dbo].ALBVENTACAB.NUMALBARAN)
      INNER JOIN [BD1].[dbo].articulos on ([BD1].[dbo].ALBVENTALIN.CODARTICULO = [BD1].[dbo].ARTICULOS.CODARTICULO)
      where [BD1].[dbo].albventacab.fecha BETWEEN #FechaIni#  AND  #FechaEnd# and [BD1].[dbo].ARTICULOS.DPTO = '1800'
      AND SECCION IN ('1801','1802','1803','1804') and [BD1].[dbo].albventacab.NUMSERIE=[BD1].[dbo].ALBVENTALIN.NUMSERIE
            UNION
      SELECT 'Pasteles' AS Articulo,
      CAST(SUM([DairyQueen].[dbo].ALBVENTALIN.TOTAL) AS DECIMAL(12,2)) AS VentasTotales
      FROM [DairyQueen].[dbo].ALBVENTALIN
      INNER JOIN [DairyQueen].[dbo].albventacab on ([DairyQueen].[dbo].ALBVENTALIN.NUMALBARAN = [DairyQueen].[dbo].ALBVENTACAB.NUMALBARAN)
      INNER JOIN [DairyQueen].[dbo].articulos on ([DairyQueen].[dbo].ALBVENTALIN.CODARTICULO = [DairyQueen].[dbo].ARTICULOS.CODARTICULO)
      where [DairyQueen].[dbo].albventacab.fecha BETWEEN #FechaIni#  AND  #FechaEnd# and [DairyQueen].[dbo].ARTICULOS.DPTO = '1100'
      AND SECCION IN ('1101','1102','1103','1104') and [DairyQueen].[dbo].albventacab.NUMSERIE=[DairyQueen].[dbo].ALBVENTALIN.NUMSERIE

      SELECT Articulo, SUM(VentasTotales) AS VentasTotales
      FROM @Pasteles GROUP BY Articulo
    </select>

    <select id="SelectVentasOtros" resultClass="DQ_Ventas" parameterClass="DQ_VentasFinder">
      <!--  
      SELECT 'Otros' AS Articulo,
      CAST(SUM(ALBVENTALIN.TOTAL) AS DECIMAL(12,2)) AS VentasTotales
      FROM ALBVENTALIN
      INNER JOIN albventacab on (ALBVENTALIN.NUMALBARAN = ALBVENTACAB.NUMALBARAN)
      INNER JOIN articulos on (ALBVENTALIN.CODARTICULO = ARTICULOS.CODARTICULO)
      WHERE ALBVENTACAB.FECHA BETWEEN #FechaIni#  AND  #FechaEnd# AND DPTO NOT IN ('1700','1800') and ALBVENTACAB.NUMSERIE=ALBVENTALIN.NUMSERIE -->
      DECLARE @Otros TABLE
      (
      Articulo VARCHAR(10),
      VentasTotales DECIMAL(12,2)
      )
      INSERT @Otros

      SELECT 'Otros' AS Articulo,
      CAST(SUM([BD1].[dbo].ALBVENTALIN.TOTAL) AS DECIMAL(12,2)) AS VentasTotales
      FROM [BD1].[dbo].ALBVENTALIN
      INNER JOIN [BD1].[dbo].albventacab on ([BD1].[dbo].ALBVENTALIN.NUMALBARAN = [BD1].[dbo].ALBVENTACAB.NUMALBARAN)
      INNER JOIN [BD1].[dbo].articulos on ([BD1].[dbo].ALBVENTALIN.CODARTICULO = [BD1].[dbo].ARTICULOS.CODARTICULO)
      WHERE [BD1].[dbo].ALBVENTACAB.FECHA BETWEEN #FechaIni#  AND  #FechaEnd# AND DPTO NOT IN ('1700','1800')
      AND [BD1].[dbo].ALBVENTACAB.NUMSERIE=[BD1].[dbo].ALBVENTALIN.NUMSERIE
      UNION
      SELECT 'Otros' AS Articulo,
      CAST(SUM([DairyQueen].[dbo].ALBVENTALIN.TOTAL) AS DECIMAL(12,2)) AS VentasTotales
      FROM [DairyQueen].[dbo].ALBVENTALIN
      INNER JOIN [DairyQueen].[dbo].albventacab on ([DairyQueen].[dbo].ALBVENTALIN.NUMALBARAN = [DairyQueen].[dbo].ALBVENTACAB.NUMALBARAN)
      INNER JOIN [DairyQueen].[dbo].articulos on ([DairyQueen].[dbo].ALBVENTALIN.CODARTICULO = [DairyQueen].[dbo].ARTICULOS.CODARTICULO)
      WHERE [DairyQueen].[dbo].ALBVENTACAB.FECHA BETWEEN #FechaIni#  AND  #FechaEnd# AND DPTO NOT IN ('1100','900')
      AND [DairyQueen].[dbo].ALBVENTACAB.NUMSERIE=[DairyQueen].[dbo].ALBVENTALIN.NUMSERIE

      SELECT Articulo, SUM(VentasTotales) AS VentasTotales
      FROM @Otros GROUP BY Articulo
    </select>

    <!--Added by Hector Sanchez M. - 20180530-->
    <select id="SelectSalesScreen" resultClass="DQ_Ventas" parameterClass="DQ_VentasFinder">
		DECLARE @PASTEL TABLE
		(
		CODARTICULO VARCHAR(50)
		)

		INSERT @PASTEL
		SELECT CODARTICULO FROM ARTICULOS
		WHERE DPTO ='1100' AND SECCION  in ('1101','1102','1103','1104')

		SELECT
		SUBSTRING(ALBVENTALIN.NUMSERIE,1,2) AS SUCURSAL,
		ALBVENTACAB.FECHA,
		SUM(ALBVENTALIN.UNIDADESTOTAL) AS NUMEROPASTELES,
		SUM(ALBVENTALIN.TOTAL) AS VENTASPASTELES
		INTO ##PASTELES
		FROM  ALBVENTACAB
		INNER JOIN ALBVENTALIN ON ALBVENTALIN.NUMSERIE = ALBVENTACAB.NUMSERIE AND ALBVENTALIN.NUMALBARAN = ALBVENTACAB.NUMALBARAN
		INNER JOIN @PASTEL P ON P.CODARTICULO = ALBVENTALIN.CODARTICULO
		WHERE ALBVENTACAB.FECHA BETWEEN #FechaIni# AND #FechaEnd#
		GROUP BY SUBSTRING(ALBVENTALIN.NUMSERIE,1,2), ALBVENTACAB.FECHA

		SELECT
		FECHA,
		SUBSTRING(NUMSERIE,1,2) AS Sucursal,
		CAST(SUM(TOTALBRUTO) AS DECIMAL(12,2)) AS VentasReales,
		CAST(SUM(CASE WHEN TOTALNETO > 0 THEN 1 WHEN TOTALNETO = 0 THEN -1 ELSE -2 END) AS DECIMAL(12,2)) AS Ordenes,
		CAST(SUM(TOTALCOSTE) AS DECIMAL(12,2)) AS CostoIdeal
		INTO ##VENTAS
		FROM ALBVENTACAB
		WHERE FECHA BETWEEN #FechaIni# AND #FechaEnd#
		GROUP BY FECHA, SUBSTRING(NUMSERIE,1,2)

		SELECT
		FECHA,
		CAST(SUBSTRING(NUMSERIE,1,2) AS DECIMAL(12,2)) AS Sucursal,
		CAST(SUM(CASE WHEN TOTALNETO = 0 THEN 1 ELSE 0 END) AS DECIMAL(12,2)) AS Ordenes,
		CAST(SUM(TOTALCOSTE) AS DECIMAL(12,2)) AS CostoIdeal
		INTO ##INVITACIONES
		FROM ALBVENTACAB
		WHERE FECHA BETWEEN #FechaIni# AND #FechaEnd# AND NUMSERIE LIKE '%I'
		GROUP BY FECHA, SUBSTRING(NUMSERIE,1,2)


		SELECT
		FECHA,
		SUBSTRING(NUMSERIE,1,2) AS Sucursal,
		(case when CODCLIENTE = 3 then CAST(SUM(TOTALBRUTO) AS DECIMAL(12,2))
		when CODCLIENTE = 1 then CAST(SUM(TOTALBRUTO) AS DECIMAL(12,2))
		when CODCLIENTE = 4 then CAST(SUM(TOTALBRUTO) AS DECIMAL(12,2))
		when CODCLIENTE = 6 then CAST(SUM(TOTALBRUTO) AS DECIMAL(12,2)) end)AS  SERVICIODOMICILIO
		INTO ##CLIENTES
		FROM ALBVENTACAB
		WHERE FECHA BETWEEN #FechaIni# AND #FechaEnd# AND CODCLIENTE IN ('3','1','4','6')
		GROUP BY  FECHA, SUBSTRING(NUMSERIE,1,2), CODCLIENTE

		SELECT
		FECHA,
		SUBSTRING(NUMSERIE,1,2) AS Sucursal,
		(case when NUMSERIE = '053T' then CAST(SUM(TOTALBRUTO) AS DECIMAL(12,2))
		when NUMSERIE = '043T' then CAST(SUM(TOTALBRUTO) AS DECIMAL(12,2))
		when NUMSERIE = '083T' then CAST(SUM(TOTALBRUTO) AS DECIMAL(12,2))
		when NUMSERIE = '103T' then CAST(SUM(TOTALBRUTO) AS DECIMAL(12,2)) End) AS VENTASDRIVE
		INTO ##VENTASREPARTO
		FROM ALBVENTACAB
		WHERE FECHA BETWEEN #FechaIni# AND #FechaEnd# AND NUMSERIE IN ('053T','043T','083T','103T')
		GROUP BY  FECHA, SUBSTRING(NUMSERIE,1,2), NUMSERIE


		SELECT
		##VENTAS.FECHA AS Fecha,
		ALMACEN.NOMBREALMACEN AS Sucursal,
		##VENTAS.VentasReales,
		##VENTAS.Ordenes,
		##VENTAS.VentasReales/##VENTAS.Ordenes AS TicketPromedio,
		ISNULL(##INVITACIONES.Ordenes, 0) AS Invitaciones,
		ISNULL(##VENTAS.CostoIdeal, 0) + ISNULL(##INVITACIONES.CostoIdeal, 0) AS UtilizadoIdeal,
		ISNULL(##PASTELES.NUMEROPASTELES, 0) AS NumeroPasteles,
		##PASTELES.VENTASPASTELES,
		sum(##CLIENTES.SERVICIODOMICILIO) as SERVICIODOMICILIO,
		##VENTASREPARTO.VENTASDRIVE
		FROM ##VENTAS
		INNER JOIN ALMACEN ON ##VENTAS.Sucursal = ALMACEN.CODALMACEN
		LEFT JOIN ##INVITACIONES ON ##VENTAS.Sucursal = ##INVITACIONES.Sucursal AND ##VENTAS.FECHA = ##INVITACIONES.FECHA
		LEFT JOIN ##PASTELES ON ##VENTAS.Sucursal = ##PASTELES.SUCURSAL AND ##VENTAS.FECHA = ##PASTELES.FECHA
		LEFT JOIN ##CLIENTES ON ##VENTAS.Sucursal = ##CLIENTES.Sucursal  AND ##VENTAS.FECHA = ##CLIENTES.FECHA
		LEFT JOIN ##VENTASREPARTO ON ##VENTAS.Sucursal = ##VENTASREPARTO.Sucursal AND ##VENTAS.FECHA = ##VENTASREPARTO.FECHA
		group by ##VENTAS.FECHA, ALMACEN.NOMBREALMACEN, ##VENTAS.VentasReales, ##VENTAS.Ordenes, ##INVITACIONES.Ordenes, ##VENTAS.CostoIdeal, ##INVITACIONES.CostoIdeal,##PASTELES.NUMEROPASTELES
		,##PASTELES.VENTASPASTELES, ##VENTASREPARTO.VENTASDRIVE
		ORDER BY ##VENTAS.FECHA, ALMACEN.NOMBREALMACEN




		DROP TABLE ##VENTAS
		DROP TABLE ##INVITACIONES
		DROP TABLE ##PASTELES
		DROP TABLE ##CLIENTES
		DROP TABLE ##VENTASREPARTO
	</select>

    <!--Added by Hector Sanchez M. - 20180604-->
    <select id="SelectSalesScreenTotal" resultClass="DQ_Ventas" parameterClass="DQ_VentasFinder">
     <!--SELECT
      CAST(SUM(TOTALBRUTO) AS DECIMAL(12,2)) AS VentasReales,
      CAST(SUM(CASE WHEN TOTALNETO > 0 THEN 1 WHEN TOTALNETO = 0 THEN -1 ELSE -2 END) AS DECIMAL(12,2)) AS Ordenes,
      (SELECT SUM(CASE WHEN VS.TOTALNETO = 0 THEN 1 ELSE 0 END) FROM ALBVENTACAB VS WHERE VS.FECHA BETWEEN #FechaIni# AND #FechaEnd# AND VS.NUMSERIE LIKE '%I' AND VS.NUMSERIE = NUMSERIE) AS Invitaciones,
      CAST(SUM(TOTALCOSTE) + ISNULL((SELECT SUM(ISNULL(VS2.TOTALCOSTE, 0)) FROM ALBVENTACAB VS2 WHERE VS2.FECHA BETWEEN #FechaIni# AND #FechaEnd# AND VS2.NUMSERIE LIKE '%I'), 0) AS DECIMAL(12,2)) AS UtilizadoIdeal
      INTO ##VENTAS
      FROM ALBVENTACAB 
      WHERE FECHA BETWEEN #FechaIni# AND #FechaEnd#

      SELECT * FROM ##VENTAS-->
  
		<!--comntado por Ariadna Caden 25/02/2021 
		    TOTALES DE LA TABLA (NO SE OCUPAN)  -->
      <!-- @PASTEL TABLE
      (
      CODARTICULO VARCHAR(50)
      )

      INSERT @PASTEL
      SELECT CODARTICULO FROM ARTICULOS
      WHERE DPTO ='1800' AND SECCION  in ('1801','1802','1803','1804')

      SELECT
      SUM(ALBVENTALIN.UNIDADESTOTAL) AS NumeroPasteles,
      1 AS PIV
      INTO ##PASTELES
      FROM  ALBVENTACAB
      INNER JOIN ALBVENTALIN ON ALBVENTALIN.NUMSERIE = ALBVENTACAB.NUMSERIE AND ALBVENTALIN.NUMALBARAN = ALBVENTACAB.NUMALBARAN
      INNER JOIN @PASTEL P ON P.CODARTICULO = ALBVENTALIN.CODARTICULO
      WHERE ALBVENTACAB.FECHA BETWEEN #FechaIni# AND #FechaEnd#

      SELECT
      CAST(SUM(TOTALBRUTO) AS DECIMAL(12,2)) AS VentasReales,
      CAST(SUM(CASE WHEN TOTALNETO > 0 THEN 1 WHEN TOTALNETO = 0 THEN -1 ELSE -2 END) AS DECIMAL(12,2)) AS Ordenes,
      (SELECT SUM(CASE WHEN VS.TOTALNETO = 0 THEN 1 ELSE 0 END) FROM ALBVENTACAB VS WHERE VS.FECHA BETWEEN #FechaIni# AND #FechaEnd# AND VS.NUMSERIE LIKE '%I' AND VS.NUMSERIE = NUMSERIE) AS Invitaciones,
      CAST(SUM(TOTALCOSTE) + ISNULL((SELECT SUM(ISNULL(VS2.TOTALCOSTE, 0)) FROM ALBVENTACAB VS2 WHERE VS2.FECHA BETWEEN #FechaIni# AND #FechaEnd# AND VS2.NUMSERIE LIKE '%I'), 0) AS DECIMAL(12,2)) AS UtilizadoIdeal,
      CAST(SUM(TOTALBRUTO) AS DECIMAL(12,2)) / CAST(SUM(CASE WHEN TOTALNETO > 0 THEN 1 WHEN TOTALNETO = 0 THEN -1 ELSE -2 END) AS DECIMAL(12,2)) AS TicketPromedio,
      1 AS PIV
      INTO ##VENTAS
      FROM ALBVENTACAB
      WHERE FECHA BETWEEN #FechaIni# AND #FechaEnd#

      SELECT * FROM ##VENTAS
      INNER JOIN ##PASTELES   ON ##PASTELES.PIV = ##VENTAS.PIV

      DROP TABLE ##VENTAS
      DROP TABLE ##PASTELES -->
    </select>
  
    <!--Added by Hector Sanchez M. - 20180731-->
    <select id="SelectSalesArticles" resultClass="DQ_VentasArticulos" parameterClass="DQ_VentasFinder">
      <!-- 
      DECLARE @VARTIC TABLE
      (
      Sucursal VARCHAR(2),
      VentasTotalesArtic DECIMAL(12,2)
      )

      INSERT @VARTIC
      SELECT
      SUBSTRING(ALBVENTALIN.NUMSERIE,1,2) AS Sucursal,
      CAST(SUM(ALBVENTALIN.TOTAL) AS DECIMAL(12,2)) AS VentasTotalesArtic
      FROM ALBVENTALIN
      inner join albventacab on (ALBVENTALIN.NUMALBARAN = ALBVENTACAB.NUMALBARAN)
      inner join articulos on (ALBVENTALIN.CODARTICULO = ARTICULOS.CODARTICULO)
      WHERE ALBVENTACAB.FECHA BETWEEN #FechaIni# AND #FechaEnd# and ARTICULOS.DPTO = '1700' and albventacab.NUMSERIE=ALBVENTALIN.NUMSERIE
      GROUP BY SUBSTRING(ALBVENTALIN.NUMSERIE,1,2)

      DECLARE @VPASTELES TABLE
      (
      Sucursal VARCHAR(2),
      VentasTotalesPasteles DECIMAL(12,2)
      )

      INSERT @VPASTELES
      SELECT
      SUBSTRING(ALBVENTALIN.NUMSERIE,1,2) AS Sucursal,
      CAST(SUM(ALBVENTALIN.TOTAL) AS DECIMAL(12,2)) AS VentasTotalesPasteles
      FROM ALBVENTALIN
      inner join albventacab on (ALBVENTALIN.NUMALBARAN = ALBVENTACAB.NUMALBARAN)
      inner join articulos on (ALBVENTALIN.CODARTICULO = ARTICULOS.CODARTICULO)
      WHERE ALBVENTACAB.FECHA BETWEEN #FechaIni# AND #FechaEnd# AND DPTO = '1800' AND SECCION IN ('1801','1802','1803','1804') and albventacab.NUMSERIE=ALBVENTALIN.NUMSERIE
      GROUP BY SUBSTRING(ALBVENTALIN.NUMSERIE,1,2)

      DECLARE @VOTROS TABLE
      (
      Sucursal VARCHAR(2),
      VentasTotalesOtros DECIMAL(12,2)
      )

      INSERT @VOTROS
      SELECT
      SUBSTRING(ALBVENTALIN.NUMSERIE,1,2) AS Sucursal,
      CAST(SUM(ALBVENTALIN.TOTAL) AS DECIMAL(12,2)) AS VentasTotalesOtros
      FROM ALBVENTALIN
      INNER JOIN albventacab on (ALBVENTALIN.NUMALBARAN = ALBVENTACAB.NUMALBARAN)
      INNER JOIN articulos on (ALBVENTALIN.CODARTICULO = ARTICULOS.CODARTICULO)
      WHERE ALBVENTACAB.FECHA BETWEEN #FechaIni# AND #FechaEnd# AND DPTO NOT IN ('1700','1800') and ALBVENTACAB.NUMSERIE=ALBVENTALIN.NUMSERIE
      GROUP BY SUBSTRING(ALBVENTALIN.NUMSERIE,1,2)

      SELECT
      NOMBREALMACEN AS Sucursal,
      VentasTotalesArtic,
      VentasTotalesPasteles,
      VentasTotalesOtros
      FROM ALMACEN
      LEFT JOIN @VARTIC A ON A.Sucursal COLLATE Modern_Spanish_CI_AS = ALMACEN.CODALMACEN  COLLATE Modern_Spanish_CI_AS
      LEFT JOIN @VPASTELES P ON P.Sucursal COLLATE Modern_Spanish_CI_AS = ALMACEN.CODALMACEN COLLATE Modern_Spanish_CI_AS
      LEFT JOIN @VOTROS O ON O.Sucursal COLLATE Modern_Spanish_CI_AS = ALMACEN.CODALMACEN COLLATE Modern_Spanish_CI_AS
      WHERE CODALMACEN NOT LIKE '%M' AND CODALMACEN <![CDATA[<>]]> 'A1'
     
		
      DECLARE @VARTIC TABLE
      (
      Sucursal VARCHAR(2),
      VentasTotalesArtic DECIMAL(12,2)
      )

      INSERT @VARTIC
      SELECT
      SUBSTRING([BD1].[dbo].ALBVENTALIN.NUMSERIE,1,2) AS Sucursal,
      CAST(SUM([BD1].[dbo].ALBVENTALIN.TOTAL) AS DECIMAL(12,2)) AS VentasTotalesArtic
      FROM [BD1].[dbo].ALBVENTALIN
      inner join [BD1].[dbo].albventacab on ([BD1].[dbo].ALBVENTALIN.NUMALBARAN = [BD1].[dbo].ALBVENTACAB.NUMALBARAN)
      inner join [BD1].[dbo].articulos on ([BD1].[dbo].ALBVENTALIN.CODARTICULO = [BD1].[dbo].ARTICULOS.CODARTICULO)
      WHERE [BD1].[dbo].ALBVENTACAB.FECHA BETWEEN #FechaIni# AND #FechaEnd# and [BD1].[dbo].ARTICULOS.DPTO = '1700'
	    and [BD1].[dbo].albventacab.NUMSERIE = [BD1].[dbo].ALBVENTALIN.NUMSERIE
      GROUP BY SUBSTRING([BD1].[dbo].ALBVENTALIN.NUMSERIE,1,2)

      DECLARE @VPASTELES TABLE
      (
      Sucursal VARCHAR(2),
      VentasTotalesPasteles DECIMAL(12,2)
      )

      INSERT @VPASTELES
      SELECT
      SUBSTRING([BD1].[dbo].ALBVENTALIN.NUMSERIE,1,2) AS Sucursal,
      CAST(SUM([BD1].[dbo].ALBVENTALIN.TOTAL) AS DECIMAL(12,2)) AS VentasTotalesPasteles
      FROM [BD1].[dbo].ALBVENTALIN
      inner join [BD1].[dbo].albventacab on ([BD1].[dbo].ALBVENTALIN.NUMALBARAN = [BD1].[dbo].ALBVENTACAB.NUMALBARAN)
      inner join [BD1].[dbo].articulos on ([BD1].[dbo].ALBVENTALIN.CODARTICULO = [BD1].[dbo].ARTICULOS.CODARTICULO)
      WHERE [BD1].[dbo].ALBVENTACAB.FECHA BETWEEN #FechaIni# AND #FechaEnd# AND DPTO = '1800' AND 
	    SECCION IN ('1801','1802','1803','1804') and [BD1].[dbo].albventacab.NUMSERIE = [BD1].[dbo].ALBVENTALIN.NUMSERIE
      GROUP BY SUBSTRING([BD1].[dbo].ALBVENTALIN.NUMSERIE,1,2)

      DECLARE @VOTROS TABLE
      (
      Sucursal VARCHAR(2),
      VentasTotalesOtros DECIMAL(12,2)
      )

      INSERT @VOTROS
      SELECT
      SUBSTRING([BD1].[dbo].ALBVENTALIN.NUMSERIE,1,2) AS Sucursal,
      CAST(SUM([BD1].[dbo].ALBVENTALIN.TOTAL) AS DECIMAL(12,2)) AS VentasTotalesOtros
      FROM [BD1].[dbo].ALBVENTALIN
      INNER JOIN [BD1].[dbo].albventacab on ([BD1].[dbo].ALBVENTALIN.NUMALBARAN = [BD1].[dbo].ALBVENTACAB.NUMALBARAN)
      INNER JOIN [BD1].[dbo].articulos on ([BD1].[dbo].ALBVENTALIN.CODARTICULO = [BD1].[dbo].ARTICULOS.CODARTICULO)
      WHERE [BD1].[dbo].ALBVENTACAB.FECHA BETWEEN #FechaIni# AND #FechaEnd# AND DPTO NOT IN ('1700','1800') 
	    and [BD1].[dbo].ALBVENTACAB.NUMSERIE = [BD1].[dbo].ALBVENTALIN.NUMSERIE
      GROUP BY SUBSTRING([BD1].[dbo].ALBVENTALIN.NUMSERIE,1,2)


	    DECLARE @Acumulate TABLE
      (
      Sucursal VARCHAR(30),
      VentasTotalesArtic DECIMAL(12,2),
	    VentasTotalesPasteles DECIMAL(12,2),
	    VentasTotalesOtros DECIMAL(12,2)
      )

	    INSERT @Acumulate
      SELECT
      NOMBREALMACEN AS Sucursal,
      VentasTotalesArtic,
      VentasTotalesPasteles,
      VentasTotalesOtros
      FROM [BD1].[dbo].ALMACEN
      LEFT JOIN @VARTIC A ON A.Sucursal COLLATE Modern_Spanish_CI_AS = [BD1].[dbo].ALMACEN.CODALMACEN  COLLATE Modern_Spanish_CI_AS
      LEFT JOIN @VPASTELES P ON P.Sucursal COLLATE Modern_Spanish_CI_AS = [BD1].[dbo].ALMACEN.CODALMACEN COLLATE Modern_Spanish_CI_AS
      LEFT JOIN @VOTROS O ON O.Sucursal COLLATE Modern_Spanish_CI_AS = [BD1].[dbo].ALMACEN.CODALMACEN COLLATE Modern_Spanish_CI_AS
      WHERE CODALMACEN NOT LIKE '%M' AND CODALMACEN <![CDATA[<>]]> 'A1'

	    /*******************************************************************/
	    /****** LOAD FIRST BD1 INTO VARIABLES TABLES, DELETE TABLES. THEN*********/
	    /****** LOAD SECOND DAIRYQUEEN DB, IN ORDER TO AVOID DUPLICATES *********/
	    /*******************************************************************/
	    DELETE FROM @VARTIC
	    DELETE FROM @VPASTELES
	    DELETE FROM @VOTROS
	  
	  	 
      INSERT @VARTIC
      SELECT
      SUBSTRING([DairyQueen].[dbo].ALBVENTALIN.NUMSERIE,1,2) AS Sucursal,
      CAST(SUM([DairyQueen].[dbo].ALBVENTALIN.TOTAL) AS DECIMAL(12,2)) AS VentasTotalesArtic
      FROM [DairyQueen].[dbo].ALBVENTALIN
      inner join [DairyQueen].[dbo].albventacab on ([DairyQueen].[dbo].ALBVENTALIN.NUMALBARAN = [DairyQueen].[dbo].ALBVENTACAB.NUMALBARAN)
      inner join [DairyQueen].[dbo].articulos on ([DairyQueen].[dbo].ALBVENTALIN.CODARTICULO = [DairyQueen].[dbo].ARTICULOS.CODARTICULO)
      WHERE [DairyQueen].[dbo].ALBVENTACAB.FECHA BETWEEN #FechaIni# AND #FechaEnd# and [DairyQueen].[dbo].ARTICULOS.DPTO in  ('900','1000')
	    and [DairyQueen].[dbo].albventacab.NUMSERIE = [DairyQueen].[dbo].ALBVENTALIN.NUMSERIE
      GROUP BY SUBSTRING([DairyQueen].[dbo].ALBVENTALIN.NUMSERIE,1,2)



	    INSERT @VPASTELES
      SELECT
      SUBSTRING([DairyQueen].[dbo].ALBVENTALIN.NUMSERIE,1,2) AS Sucursal,
      CAST(SUM([DairyQueen].[dbo].ALBVENTALIN.TOTAL) AS DECIMAL(12,2)) AS VentasTotalesPasteles
      FROM [DairyQueen].[dbo].ALBVENTALIN
      inner join [DairyQueen].[dbo].albventacab on ([DairyQueen].[dbo].ALBVENTALIN.NUMALBARAN = [DairyQueen].[dbo].ALBVENTACAB.NUMALBARAN)
      inner join [DairyQueen].[dbo].articulos on ([DairyQueen].[dbo].ALBVENTALIN.CODARTICULO = [DairyQueen].[dbo].ARTICULOS.CODARTICULO)
      WHERE [DairyQueen].[dbo].ALBVENTACAB.FECHA BETWEEN #FechaIni# AND #FechaEnd# AND DPTO = '1100' 
	    AND SECCION IN ('1101','1102','1103','1104') and [DairyQueen].[dbo].albventacab.NUMSERIE = [DairyQueen].[dbo].ALBVENTALIN.NUMSERIE
      GROUP BY SUBSTRING([DairyQueen].[dbo].ALBVENTALIN.NUMSERIE,1,2)

	  

      INSERT @VOTROS
      SELECT
      SUBSTRING([DairyQueen].[dbo].ALBVENTALIN.NUMSERIE,1,2) AS Sucursal,
      CAST(SUM([DairyQueen].[dbo].ALBVENTALIN.TOTAL) AS DECIMAL(12,2)) AS VentasTotalesOtros
      FROM [DairyQueen].[dbo].ALBVENTALIN
      INNER JOIN [DairyQueen].[dbo].albventacab on ([DairyQueen].[dbo].ALBVENTALIN.NUMALBARAN = [DairyQueen].[dbo].ALBVENTACAB.NUMALBARAN)
      INNER JOIN [DairyQueen].[dbo].articulos on ([DairyQueen].[dbo].ALBVENTALIN.CODARTICULO = [DairyQueen].[dbo].ARTICULOS.CODARTICULO)
      WHERE [DairyQueen].[dbo].ALBVENTACAB.FECHA BETWEEN #FechaIni# AND #FechaEnd#
	    AND DPTO NOT IN ('900','1100','1000') and [DairyQueen].[dbo].ALBVENTACAB.NUMSERIE = [DairyQueen].[dbo].ALBVENTALIN.NUMSERIE
      GROUP BY SUBSTRING([DairyQueen].[dbo].ALBVENTALIN.NUMSERIE,1,2)


	    INSERT @Acumulate
      SELECT
      NOMBREALMACEN AS Sucursal,
      VentasTotalesArtic,
      VentasTotalesPasteles,
      VentasTotalesOtros
      FROM [DairyQueen].[dbo].ALMACEN
      LEFT JOIN @VARTIC A ON A.Sucursal COLLATE Modern_Spanish_CI_AS = [DairyQueen].[dbo].ALMACEN.CODALMACEN  COLLATE Modern_Spanish_CI_AS
      LEFT JOIN @VPASTELES P ON P.Sucursal COLLATE Modern_Spanish_CI_AS = [DairyQueen].[dbo].ALMACEN.CODALMACEN COLLATE Modern_Spanish_CI_AS
      LEFT JOIN @VOTROS O ON O.Sucursal COLLATE Modern_Spanish_CI_AS = [DairyQueen].[dbo].ALMACEN.CODALMACEN COLLATE Modern_Spanish_CI_AS
      WHERE CODALMACEN NOT LIKE '%M' AND CODALMACEN <![CDATA[<>]]> 'A1'


	    SELECT Sucursal, SUM(VentasTotalesArtic) AS VentasTotalesArtic,
	    SUM(VentasTotalesPasteles) AS VentasTotalesPasteles, SUM(VentasTotalesOtros) AS VentasTotalesOtros
	    FROM @Acumulate GROUP BY Sucursal  -->
	
	  
DECLARE @VARTIC TABLE
      (
      Sucursal VARCHAR(2),
      VentasTotalesArtic DECIMAL(12,2),
	  VtaArtic DECIMAL(12,2)
      )
	  	 
      INSERT @VARTIC
 	Select 	
		SUBSTRING([DairyQueen].[dbo].albventalin.NUMSERIE,1,2) as Sucursal ,
		sum([DairyQueen].[dbo].albventalin.TOTAL) as VentasTotalesArtic,
		sum([DairyQueen].[dbo].COSTESPORALMACEN.ULTIMOCOSTE*[DairyQueen].[dbo].albventalin.UNIDADESTOTAL) as VtaArtic
		from [DairyQueen].[dbo].albventalin 
		inner join [DairyQueen].[dbo].ARTICULOS 
		on [DairyQueen].[dbo].ARTICULOS.CODARTICULO= [DairyQueen].[dbo].albventalin.CODARTICULO
		full join [DairyQueen].[dbo].COSTESPORALMACEN
		on [DairyQueen].[dbo].ARTICULOS.CODARTICULO=[DairyQueen].[dbo].COSTESPORALMACEN.CODARTICULO
		FULL JOIN [DairyQueen].[dbo].ALBVENTACAB
		ON [DairyQueen].[dbo].albventalin.NUMALBARAN= [DairyQueen].[dbo].ALBVENTACAB.NUMALBARAN AND
		[DairyQueen].[dbo].albventalin.NUMSERIE=[DairyQueen].[dbo].ALBVENTACAB.NUMSERIE
		where [DairyQueen].[dbo].ARTICULOS.MARCA ='3'  and [DairyQueen].[dbo].COSTESPORALMACEN.CODALMACEN = SUBSTRING([DairyQueen].[dbo].albventalin.NUMSERIE,1,2) AND 
		[DairyQueen].[dbo].ALBVENTACAB.FECHA BETWEEN #FechaIni# AND #FechaEnd#
		group by SUBSTRING([DairyQueen].[dbo].albventalin.NUMSERIE,1,2)


	 DECLARE @VPASTELES TABLE
      (
      Sucursal VARCHAR(2),
	  VentasTotalesPasteles DECIMAL(12,2),
      VtaPasteles DECIMAL(12,2)
      )

	  INSERT @VPASTELES

		Select 	
		SUBSTRING([DairyQueen].[dbo].albventalin.NUMSERIE,1,2) as Sucursal ,
		sum([DairyQueen].[dbo].albventalin.TOTAL) as VentasTotalesPasteles,
		sum([DairyQueen].[dbo].COSTESPORALMACEN.ULTIMOCOSTE*[DairyQueen].[dbo].albventalin.UNIDADESTOTAL) as VtaPasteles		
		from [DairyQueen].[dbo].albventalin 
		inner join [DairyQueen].[dbo].ARTICULOS 
		on [DairyQueen].[dbo].ARTICULOS.CODARTICULO= [DairyQueen].[dbo].albventalin.CODARTICULO
		full join [DairyQueen].[dbo].COSTESPORALMACEN
		on [DairyQueen].[dbo].ARTICULOS.CODARTICULO=[DairyQueen].[dbo].COSTESPORALMACEN.CODARTICULO
		FULL JOIN [DairyQueen].[dbo].ALBVENTACAB
		ON [DairyQueen].[dbo].albventalin.NUMALBARAN= [DairyQueen].[dbo].ALBVENTACAB.NUMALBARAN AND
		[DairyQueen].[dbo].albventalin.NUMSERIE=[DairyQueen].[dbo].ALBVENTACAB.NUMSERIE
		where [DairyQueen].[dbo].ARTICULOS.MARCA ='2'  and [DairyQueen].[dbo].COSTESPORALMACEN.CODALMACEN = SUBSTRING([DairyQueen].[dbo].albventalin.NUMSERIE,1,2) AND 
		[DairyQueen].[dbo].ALBVENTACAB.FECHA BETWEEN #FechaIni# AND #FechaEnd#
		group by SUBSTRING([DairyQueen].[dbo].albventalin.NUMSERIE,1,2)


	  
      DECLARE @VOTROS TABLE
      (
      Sucursal VARCHAR(2),
      VentasTotalesOtros2 DECIMAL(12,2),
	  VtaOtros DECIMAL(12,2)
      )

      INSERT @VOTROS
   

	  Select  
		SUBSTRING([DairyQueen].[dbo].albventalin.NUMSERIE,1,2) as Sucursal,
		sum([DairyQueen].[dbo].ALBVENTALIN.TOTAL) as VentasTotalesOtros,
		sum([DairyQueen].[dbo].COSTESPORALMACEN .ULTIMOCOSTE*[DairyQueen].[dbo].ALBVENTALIN.UNIDADESTOTAL) as VtaOtros	
		from [DairyQueen].[dbo].ALBVENTALIN 
		inner JOIN [DairyQueen].[dbo].ALBVENTACAB 
		ON [DairyQueen].[dbo].ALBVENTALIN .NUMALBARAN= [DairyQueen].[dbo].ALBVENTACAB.NUMALBARAN
		inner join [DairyQueen].[dbo].ARTICULOS 
		on [DairyQueen].[dbo].ALBVENTALIN .CODARTICULO= [DairyQueen].[dbo].ARTICULOS.CODARTICULO
		inner join [DairyQueen].[dbo].COSTESPORALMACEN 
		on [DairyQueen].[dbo].ARTICULOS.CODARTICULO= [DairyQueen].[dbo].COSTESPORALMACEN .CODARTICULO
		where   
		[DairyQueen].[dbo].COSTESPORALMACEN.CODALMACEN=SUBSTRING([DairyQueen].[dbo].ALBVENTALIN.NUMSERIE,1,2)  AND
		[DairyQueen].[dbo].ARTICULOS.MARCA ='1' and
		[DairyQueen].[dbo].ALBVENTALIN.NUMSERIE = [DairyQueen].[dbo].ALBVENTACAB.NUMSERIE and
		[DairyQueen].[dbo].ALBVENTACAB.FECHA BETWEEN #FechaIni# AND #FechaEnd#
		group by SUBSTRING([DairyQueen].[dbo].ALBVENTALIN.NUMSERIE,1,2)

		     DECLARE @VOTROSDQ TABLE
      (
      Sucursal VARCHAR(2),
      VentasTotalesOtros DECIMAL(12,2)
      )

      INSERT @VOTROSDQ

	  Select 
	  SUBSTRING([DairyQueen].[dbo].albventalin.NUMSERIE,1,2) as Sucursal,
	  sum([DairyQueen].[dbo].ALBVENTALIN.TOTAL) as VentasTotalesOtros   
		from [DairyQueen].[dbo].ALBVENTALIN
		inner JOIN [DairyQueen].[dbo].ALBVENTACAB 
		ON [DairyQueen].[dbo].ALBVENTALIN.NUMALBARAN= [DairyQueen].[dbo].ALBVENTACAB.NUMALBARAN
		inner join [DairyQueen].[dbo].ARTICULOS 
		on [DairyQueen].[dbo].ALBVENTALIN.CODARTICULO= [DairyQueen].[dbo].ARTICULOS .CODARTICULO
		where   
		[DairyQueen].[dbo].ARTICULOS.MARCA ='1' and
		[DairyQueen].[dbo].ALBVENTALIN.NUMSERIE=[DairyQueen].[dbo].ALBVENTACAB.NUMSERIE and
		[DairyQueen].[dbo].ALBVENTACAB.FECHA BETWEEN #FechaIni# AND #FechaEnd#
		group by SUBSTRING([DairyQueen].[dbo].ALBVENTALIN.NUMSERIE,1,2) 
 

	      DECLARE @Acumulate TABLE
      (
      Sucursal VARCHAR(30),
      VentasTotalesArtic DECIMAL(12,2),
	  VtaArtic DECIMAL(12,2),
	  VentasTotalesPasteles DECIMAL(12,2),
	  VtaPasteles DECIMAL(12,2),
      VentasTotalesOtros DECIMAL(12,2),
	  VtaOtros DECIMAL(12,2)
	)

	    INSERT @Acumulate
      SELECT
      NOMBREALMACEN AS Sucursal,
      VentasTotalesArtic,
	  VtaArtic,
	  VentasTotalesPasteles,
	  VtaPasteles,
      VentasTotalesOtros,
	  VtaOtros
      FROM [DairyQueen].[dbo].ALMACEN
      LEFT JOIN @VARTIC A ON A.Sucursal COLLATE Modern_Spanish_CI_AS = [DairyQueen].[dbo].ALMACEN.CODALMACEN  COLLATE Modern_Spanish_CI_AS
      LEFT JOIN @VPASTELES C ON C.Sucursal COLLATE Modern_Spanish_CI_AS = [DairyQueen].[dbo].ALMACEN.CODALMACEN COLLATE Modern_Spanish_CI_AS 
      LEFT JOIN @VOTROS E ON E.Sucursal COLLATE Modern_Spanish_CI_AS = [DairyQueen].[dbo].ALMACEN.CODALMACEN COLLATE Modern_Spanish_CI_AS
	  LEFT JOIN @VOTROSDQ G ON G.Sucursal COLLATE Modern_Spanish_CI_AS = [DairyQueen].[dbo].ALMACEN.CODALMACEN COLLATE Modern_Spanish_CI_AS
      WHERE CODALMACEN NOT LIKE '%M' AND CODALMACEN <![CDATA[<>]]> 'A1'

	   SELECT Sucursal, SUM(VentasTotalesArtic) AS VentasTotalesArtic, sum(VtaArtic)as ArticCostoDinero, convert(numeric(10,4),(sum(VtaArtic/VentasTotalesArtic))) as CostoPorc,
        SUM(VentasTotalesPasteles) AS VentasTotalesPasteles, sum ( VtaPasteles) as PastelesCostoDinero, convert(numeric(10,4),(sum( VtaPasteles/VentasTotalesPasteles))) as PastelesCostoPorc,
		SUM(VentasTotalesOtros) AS VentasTotalesOtros, sum(VtaOtros) as OtrosCostoDinero,convert(numeric(10,4),(sum(VtaOtros/VentasTotalesOtros))) as OtrosCostoPorc
	    FROM @Acumulate GROUP BY Sucursal, VentasTotalesOtros order by Sucursal

	
		


	 DELETE FROM @VARTIC
	 DELETE FROM @VPASTELES
	 DELETE FROM @VOTROS
	  
	  
	  
	  
    </select>
    
   
		
			
			
			
			
			
			
			
			
			
    <select id="selectDQVentasyOrdenesLineal" resultClass="DQ_Ventas" parameterClass="DQ_VentasFinder">     
      declare @ns varchar(2) = #Sucursal#
      declare @datein date = #fechaIni#
      declare @deteend date = #FechaEnd#

      DECLARE @VENTAS TABLE
      (
      SUCURSAL VARCHAR(2),
      FECHA DATETIME,
      VENTASREALES DECIMAL(10,2),
      ORDENES INT
      )

      INSERT @VENTAS
      SELECT
      SUBSTRING(NUMSERIE,1,2) AS SUCURSAL,
      FECHA,
      SUM(TOTALBRUTO) AS VENTASREALES,
      SUM( CASE WHEN TOTALNETO>0 then 1
      when TOTALNETO=0 then -1 ELSE -2 END) AS ORDENES
      FROM [BD1].[dbo].ALBVENTACAB
      WHERE FECHA BETWEEN @datein AND @deteend AND TOTALBRUTO &lt;&gt; 0
      GROUP BY SUBSTRING(NUMSERIE,1,2), FECHA
			          UNION
	    SELECT
      SUBSTRING(NUMSERIE,1,2) AS SUCURSAL,
      FECHA,
      SUM(TOTALBRUTO) AS VENTASREALES,
      SUM( CASE WHEN TOTALNETO>0 then 1
      when TOTALNETO=0 then -1 ELSE -2 END) AS ORDENES
      FROM [Dairyqueen].[dbo].ALBVENTACAB
      WHERE FECHA BETWEEN @datein AND @deteend AND TOTALBRUTO &lt;&gt; 0
      GROUP BY SUBSTRING(NUMSERIE,1,2), FECHA

      /********************************ADDED BY Leobardo Mtz. - 20191211 *****************************/
      /***********************************************************************************************/
      /***********************************************************************************************/

      SELECT
      CASE
      WHEN SUCURSAL = 01  THEN 34	/*sendero*/
      WHEN SUCURSAL = 02  THEN 33	/*lomas*/
      WHEN SUCURSAL = 03  THEN 32	/*dorado*/
      WHEN SUCURSAL = 04  THEN 35	/*valles*/
      WHEN SUCURSAL = 05  THEN 37	/*chapultepec*/
      WHEN SUCURSAL = 06  THEN 36	/*centro*/
      WHEN SUCURSAL = 07  THEN 38	/*WTC*/
      WHEN SUCURSAL = 08  THEN 39	/*contruplaza*/
      WHEN SUCURSAL = 09  THEN 41	/*matehuala*/
      WHEN SUCURSAL = 10  THEN 42	/*carranza*/
      END AS NumTienda ,
      V.SUCURSAL AS Sucursal,
      V.FECHA AS Fecha,
      V.VENTASREALES AS VentasReales,
      V.ORDENES AS Ordenes,
      /*CASE  when DATEPART(dw,V.FECHA)=1  then 7 else DATEPART(dw,V.FECHA)-1 end  AS NumDia,*/
      DATEPART(dw,V.FECHA) AS NumDia,
      DATEPART(ISO_WEEK,V.FECHA) as NumSemana
      FROM @VENTAS AS V
      ORDER BY V.SUCURSAL,V.FECHA
      
    </select>

	  <select id="selectDQContabilidad" resultClass="Contabilidad" parameterClass="DQ_VentasFinder">
		  Declare @Fecha Datetime
		  DECLARE @MONTH INT
		  DECLARE @YEAR INT
		  Set @Fecha = (DATEADD(MONTH, -1,GETDATE()))

		  SET @MONTH=MONTH(@Fecha)
		  SET @YEAR=YEAR(@Fecha)

		  DECLARE @CONTABILIDAD TABLE
		  (
		  SENDERO DECIMAL (10,4),
		  LOMAS DECIMAL (10,4),
		  DORADO DECIMAL (10,4),
		  VALLES DECIMAL (10,4),
		  CHAPULTEPEC DECIMAL (10,4),
		  CENTRO DECIMAL (10,4),
		  WTC DECIMAL (10,4),
		  CONSTRUPLAZA DECIMAL (10,4),
		  MATEHUALA DECIMAL (10,4),
		  CARRANZA DECIMAL (10,4),
		  FENAPO DECIMAL (10,4),
		  GALERIA DECIMAL (10,4),
		  PACHUCA DECIMAL (10,4)
		  )
		  /***********Ventas Netas Mostrador***********/
		  IF EXISTS(
		  SELECT * FROM (
		  SELECT  subcuenta, abonos
		  FROM [Madapal].[dbo].[Acum] where empresa='RODPE' AND Ejercicio=@YEAR and periodo=@MONTH AND cuenta in ('4100-001-002-000001')
		  group by subcuenta,abonos ) S
		  PIVOT (
		  SUM(abonos)
		  for [subcuenta] in ([14001],[14002],[14003],[14004],[14005],[14006],[14007],[14008],[14009],[14010],[14013],[14011],[14012])
		  ) P)
		  INSERT @CONTABILIDAD SELECT * FROM (
		  SELECT  subcuenta, abonos
		  FROM [Madapal].[dbo].[Acum] where empresa='RODPE' AND Ejercicio=@YEAR and periodo=@MONTH AND cuenta in ('4100-001-002-000001')
		  group by subcuenta,abonos ) S
		  PIVOT (
		  SUM(abonos)
		  for [subcuenta] in ([14001],[14002],[14003],[14004],[14005],[14006],[14007],[14008],[14009],[14010],[14013],[14011],[14012])
		  ) P
		  ELSE
		  INSERT INTO @CONTABILIDAD VALUES (NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL)



		  /***********Ventas Netas devoluciones***********/
		  IF EXISTS(
		  SELECT * FROM (
		  SELECT  subcuenta, abonos
		  FROM [Madapal].[dbo].[Acum] where empresa='RODPE' AND Ejercicio=@YEAR and periodo=@MONTH AND cuenta in ('4100-001-001-000000')
		  group by subcuenta,abonos ) S
		  PIVOT (
		  SUM(abonos)
		  for [subcuenta] in ([14001],[14002],[14003],[14004],[14005],[14006],[14007],[14008],[14009],[14010],[14013],[14011],[14012])
		  ) P)
		  INSERT @CONTABILIDAD SELECT * FROM (
		  SELECT  subcuenta, abonos
		  FROM [Madapal].[dbo].[Acum] where empresa='RODPE' AND Ejercicio=@YEAR and periodo=@MONTH AND cuenta in ('4100-001-001-000000')
		  group by subcuenta,abonos ) S
		  PIVOT (
		  SUM(abonos)
		  for [subcuenta] in ([14001],[14002],[14003],[14004],[14005],[14006],[14007],[14008],[14009],[14010],[14013],[14011],[14012])
		  ) P
		  ELSE
		  INSERT INTO @CONTABILIDAD VALUES (NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL)



		  /***********Regalias Extranjero***********/
		  IF EXISTS(
		  SELECT * FROM (
		  SELECT  subcuenta, cargos
		  FROM [Madapal].[dbo].[Acum] where empresa='RODPE' AND Ejercicio=@YEAR and periodo=@MONTH AND cuenta in ('6100-002-000-000000')
		  group by subcuenta,cargos ) S
		  PIVOT (
		  SUM(cargos)
		  for [subcuenta] in ([14001],[14002],[14003],[14004],[14005],[14006],[14007],[14008],[14009],[14010],[14013],[14011],[14012])
		  ) P)
		  INSERT @CONTABILIDAD  SELECT * FROM (
		  SELECT  subcuenta, cargos
		  FROM [Madapal].[dbo].[Acum] where empresa='RODPE' AND Ejercicio=@YEAR and periodo=@MONTH AND cuenta in ('6100-002-000-000000')
		  group by subcuenta,cargos ) S
		  PIVOT (
		  SUM(cargos)
		  for [subcuenta] in ([14001],[14002],[14003],[14004],[14005],[14006],[14007],[14008],[14009],[14010],[14013],[14011],[14012])
		  ) P
		  ELSE
		  INSERT INTO @CONTABILIDAD VALUES (NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL)



		  /***********Agua Potable***********/
		  IF EXISTS(
		  SELECT * FROM (
		  SELECT  subcuenta, cargos
		  FROM [Madapal].[dbo].[Acum] where empresa='RODPE' AND Ejercicio=@YEAR and periodo=@MONTH AND cuenta in ('6100-008-000-000000')
		  group by subcuenta,cargos ) S
		  PIVOT (
		  SUM(cargos)
		  for [subcuenta] in ([14001],[14002],[14003],[14004],[14005],[14006],[14007],[14008],[14009],[14010],[14013],[14011],[14012])
		  ) P)
		  INSERT @CONTABILIDAD  SELECT * FROM (
		  SELECT  subcuenta, cargos
		  FROM [Madapal].[dbo].[Acum] where empresa='RODPE' AND Ejercicio=@YEAR and periodo=@MONTH AND cuenta in ('6100-008-000-000000')
		  group by subcuenta,cargos ) S
		  PIVOT (
		  SUM(cargos)
		  for [subcuenta] in ([14001],[14002],[14003],[14004],[14005],[14006],[14007],[14008],[14009],[14010],[14013],[14011],[14012])
		  ) P
		  ELSE
		  INSERT INTO @CONTABILIDAD VALUES (NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL)



		  /***********Energia Electrica***********/
		  IF EXISTS(
		  SELECT * FROM (
		  SELECT  subcuenta, cargos
		  FROM [Madapal].[dbo].[Acum] where empresa='RODPE' AND Ejercicio=@YEAR and periodo=@MONTH AND cuenta in ('6100-009-000-000000')
		  group by subcuenta,cargos ) S
		  PIVOT (
		  SUM(cargos)
		  for [subcuenta] in ([14001],[14002],[14003],[14004],[14005],[14006],[14007],[14008],[14009],[14010],[14013],[14011],[14012])
		  ) P)
		  INSERT @CONTABILIDAD  SELECT * FROM (
		  SELECT  subcuenta, cargos
		  FROM [Madapal].[dbo].[Acum] where empresa='RODPE' AND Ejercicio=@YEAR and periodo=@MONTH AND cuenta in ('6100-009-000-000000')
		  group by subcuenta,cargos ) S
		  PIVOT (
		  SUM(cargos)
		  for [subcuenta] in ([14001],[14002],[14003],[14004],[14005],[14006],[14007],[14008],[14009],[14010],[14013],[14011],[14012])
		  ) P
		  ELSE
		  INSERT INTO @CONTABILIDAD VALUES (NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL)



		  /***********Telefono***********/
		  IF EXISTS(
		  SELECT * FROM (
		  SELECT  subcuenta, cargos
		  FROM [Madapal].[dbo].[Acum] where empresa='RODPE' AND Ejercicio=@YEAR and periodo=@MONTH AND cuenta in ('6100-011-000-000000')
		  group by subcuenta,cargos ) S
		  PIVOT (
		  SUM(cargos)
		  for [subcuenta] in ([14001],[14002],[14003],[14004],[14005],[14006],[14007],[14008],[14009],[14010],[14013],[14011],[14012])
		  ) P)
		  INSERT @CONTABILIDAD  SELECT * FROM (
		  SELECT  subcuenta, cargos
		  FROM [Madapal].[dbo].[Acum] where empresa='RODPE' AND Ejercicio=@YEAR and periodo=@MONTH AND cuenta in ('6100-011-000-000000')
		  group by subcuenta,cargos ) S
		  PIVOT (
		  SUM(cargos)
		  for [subcuenta] in ([14001],[14002],[14003],[14004],[14005],[14006],[14007],[14008],[14009],[14010],[14013],[14011],[14012])
		  ) P
		  ELSE
		  INSERT INTO @CONTABILIDAD VALUES (NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL)



		  /***********Telefono Celulares***********/
		  IF EXISTS(
		  SELECT * FROM (
		  SELECT  subcuenta, cargos
		  FROM [Madapal].[dbo].[Acum] where empresa='RODPE' AND Ejercicio=@YEAR and periodo=@MONTH AND cuenta in ('6100-012-000-000000')
		  group by subcuenta,cargos ) S
		  PIVOT (
		  SUM(cargos)
		  for [subcuenta] in ([14001],[14002],[14003],[14004],[14005],[14006],[14007],[14008],[14009],[14010],[14013],[14011],[14012])
		  ) P)
		  INSERT @CONTABILIDAD  SELECT * FROM (
		  SELECT  subcuenta, cargos
		  FROM [Madapal].[dbo].[Acum] where empresa='RODPE' AND Ejercicio=@YEAR and periodo=@MONTH AND cuenta in ('6100-012-000-000000')
		  group by subcuenta,cargos ) S
		  PIVOT (
		  SUM(cargos)
		  for [subcuenta] in ([14001],[14002],[14003],[14004],[14005],[14006],[14007],[14008],[14009],[14010],[14013],[14011],[14012])
		  ) P
		  ELSE
		  INSERT INTO @CONTABILIDAD VALUES (NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL)


		  /***********Renta de Locales y Mant Plaza***********/
		  IF EXISTS(
		  SELECT * FROM (
		  SELECT  subcuenta, cargos
		  FROM [Madapal].[dbo].[Acum] where empresa='RODPE' AND Ejercicio=@YEAR and periodo=@MONTH AND cuenta in ('6100-013-000-000000')
		  group by subcuenta,cargos ) S
		  PIVOT (
		  SUM(cargos)
		  for [subcuenta] in ([14001],[14002],[14003],[14004],[14005],[14006],[14007],[14008],[14009],[14010],[14013],[14011],[14012])
		  ) P)
		  INSERT @CONTABILIDAD  SELECT * FROM (
		  SELECT  subcuenta, cargos
		  FROM [Madapal].[dbo].[Acum] where empresa='RODPE' AND Ejercicio=@YEAR and periodo=@MONTH AND cuenta in ('6100-013-000-000000')
		  group by subcuenta,cargos ) S
		  PIVOT (
		  SUM(cargos)
		  for [subcuenta] in ([14001],[14002],[14003],[14004],[14005],[14006],[14007],[14008],[14009],[14010],[14013],[14011],[14012])
		  ) P
		  ELSE
		  INSERT INTO @CONTABILIDAD VALUES (NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL)




		  /***********Alarmas***********/
		  IF EXISTS(
		  SELECT * FROM (
		  SELECT  subcuenta, cargos
		  FROM [Madapal].[dbo].[Acum] where empresa='RODPE' AND Ejercicio=@YEAR and periodo=@MONTH AND cuenta in ('6100-014-000-000000')
		  group by subcuenta,cargos ) S
		  PIVOT (
		  SUM(cargos)
		  for [subcuenta] in ([14001],[14002],[14003],[14004],[14005],[14006],[14007],[14008],[14009],[14010],[14013],[14011],[14012])
		  ) P)
		  INSERT @CONTABILIDAD  SELECT * FROM (
		  SELECT  subcuenta, cargos
		  FROM [Madapal].[dbo].[Acum] where empresa='RODPE' AND Ejercicio=@YEAR and periodo=@MONTH AND cuenta in ('6100-014-000-000000')
		  group by subcuenta,cargos ) S
		  PIVOT (
		  SUM(cargos)
		  for [subcuenta] in ([14001],[14002],[14003],[14004],[14005],[14006],[14007],[14008],[14009],[14010],[14013],[14011],[14012])
		  ) P
		  ELSE
		  INSERT INTO @CONTABILIDAD VALUES (NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL)





		  /***********Fumigaciones***********/
		  IF EXISTS(
		  SELECT * FROM (
		  SELECT  subcuenta, cargos
		  FROM [Madapal].[dbo].[Acum] where empresa='RODPE' AND Ejercicio=@YEAR and periodo=@MONTH AND cuenta in ('6100-015-000-000000')
		  group by subcuenta,cargos ) S
		  PIVOT (
		  SUM(cargos)
		  for [subcuenta] in ([14001],[14002],[14003],[14004],[14005],[14006],[14007],[14008],[14009],[14010],[14013],[14011],[14012])
		  ) P)
		  INSERT @CONTABILIDAD  SELECT * FROM (
		  SELECT  subcuenta, cargos
		  FROM [Madapal].[dbo].[Acum] where empresa='RODPE' AND Ejercicio=@YEAR and periodo=@MONTH AND cuenta in ('6100-015-000-000000')
		  group by subcuenta,cargos ) S
		  PIVOT (
		  SUM(cargos)
		  for [subcuenta] in ([14001],[14002],[14003],[14004],[14005],[14006],[14007],[14008],[14009],[14010],[14013],[14011],[14012])
		  ) P
		  ELSE
		  INSERT INTO @CONTABILIDAD VALUES (NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL)



		  /***********Aseo y Limpieza***********/
		  IF EXISTS(
		  SELECT * FROM (
		  SELECT  subcuenta, cargos
		  FROM [Madapal].[dbo].[Acum] where empresa='RODPE' AND Ejercicio=@YEAR and periodo=@MONTH AND cuenta in ('6100-017-000-000000')
		  group by subcuenta,cargos ) S
		  PIVOT (
		  SUM(cargos)
		  for [subcuenta] in ([14001],[14002],[14003],[14004],[14005],[14006],[14007],[14008],[14009],[14010],[14013],[14011],[14012])
		  ) P)
		  INSERT @CONTABILIDAD  SELECT * FROM (
		  SELECT  subcuenta, cargos
		  FROM [Madapal].[dbo].[Acum] where empresa='RODPE' AND Ejercicio=@YEAR and periodo=@MONTH AND cuenta in ('6100-017-000-000000')
		  group by subcuenta,cargos ) S
		  PIVOT (
		  SUM(cargos)
		  for [subcuenta] in ([14001],[14002],[14003],[14004],[14005],[14006],[14007],[14008],[14009],[14010],[14013],[14011],[14012])
		  ) P
		  ELSE
		  INSERT INTO @CONTABILIDAD VALUES (NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL)



		  /***********Papeleria***********/
		  IF EXISTS(
		  SELECT * FROM (
		  SELECT  subcuenta, cargos
		  FROM [Madapal].[dbo].[Acum] where empresa='RODPE' AND Ejercicio='2021' and periodo=@MONTH AND cuenta in ('6100-018-000-000000')
		  group by subcuenta,cargos ) S
		  PIVOT (
		  SUM(cargos)
		  for [subcuenta] in ([14001],[14002],[14003],[14004],[14005],[14006],[14007],[14008],[14009],[14010],[14013],[14011],[14012])
		  ) P)
		  INSERT @CONTABILIDAD  SELECT * FROM (
		  SELECT  subcuenta, cargos
		  FROM [Madapal].[dbo].[Acum] where empresa='RODPE' AND Ejercicio='2021' and periodo=@MONTH AND cuenta in ('6100-018-000-000000')
		  group by subcuenta,cargos ) S
		  PIVOT (
		  SUM(cargos)
		  for [subcuenta] in ([14001],[14002],[14003],[14004],[14005],[14006],[14007],[14008],[14009],[14010],[14013],[14011],[14012])
		  ) P
		  ELSE
		  INSERT INTO @CONTABILIDAD VALUES (NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL)



		  /***********Traslado de Valores***********/
		  IF EXISTS(
		  SELECT * FROM (
		  SELECT  subcuenta, cargos
		  FROM [Madapal].[dbo].[Acum] where empresa='RODPE' AND Ejercicio=@YEAR and periodo='1' AND cuenta in ('6100-018-000-000000')
		  group by subcuenta,cargos ) S
		  PIVOT (
		  SUM(cargos)
		  for [subcuenta] in ([14001],[14002],[14003],[14004],[14005],[14006],[14007],[14008],[14009],[14010],[14013],[14011],[14012])
		  ) P)
		  INSERT @CONTABILIDAD  SELECT * FROM (
		  SELECT  subcuenta, cargos
		  FROM [Madapal].[dbo].[Acum] where empresa='RODPE' AND Ejercicio=@YEAR and periodo='1' AND cuenta in ('6100-018-000-000000')
		  group by subcuenta,cargos ) S
		  PIVOT (
		  SUM(cargos)
		  for [subcuenta] in ([14001],[14002],[14003],[14004],[14005],[14006],[14007],[14008],[14009],[14010],[14013],[14011],[14012])
		  ) P
		  ELSE
		  INSERT INTO @CONTABILIDAD VALUES (NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL)




		  /***********Mantenimiento local***********/
		  IF EXISTS (
		  SELECT * FROM (
		  SELECT  subcuenta, cargos
		  FROM [Madapal].[dbo].[Acum] where empresa='RODPE' AND Ejercicio=@YEAR and periodo=@MONTH AND cuenta in ('6100-023-001-000000')
		  group by subcuenta,cargos ) S
		  PIVOT (
		  SUM(cargos)
		  for [subcuenta] in ([14001],[14002],[14003],[14004],[14005],[14006],[14007],[14008],[14009],[14010],[14013],[14011],[14012])
		  ) P)
		  INSERT @CONTABILIDAD  SELECT * FROM (
		  SELECT  subcuenta, cargos
		  FROM [Madapal].[dbo].[Acum] where empresa='RODPE' AND Ejercicio=@YEAR and periodo=@MONTH AND cuenta in ('6100-023-001-000000')
		  group by subcuenta,cargos ) S
		  PIVOT (
		  SUM(cargos)
		  for [subcuenta] in ([14001],[14002],[14003],[14004],[14005],[14006],[14007],[14008],[14009],[14010],[14013],[14011],[14012])
		  ) P
		  ELSE
		  INSERT INTO @CONTABILIDAD VALUES (NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL)





		  /***********Mtto Maquinaria y equipo***********/
		  IF EXISTS (
		  SELECT * FROM (
		  SELECT  subcuenta, cargos
		  FROM [Madapal].[dbo].[Acum] where empresa='RODPE' AND Ejercicio=@YEAR and periodo=@MONTH AND cuenta in ('6100-023-002-000000')
		  group by subcuenta,cargos ) S
		  PIVOT (
		  SUM(cargos)
		  for [subcuenta] in ([14001],[14002],[14003],[14004],[14005],[14006],[14007],[14008],[14009],[14010],[14013],[14011],[14012])
		  ) P)
		  INSERT @CONTABILIDAD  SELECT * FROM (
		  SELECT  subcuenta, cargos
		  FROM [Madapal].[dbo].[Acum] where empresa='RODPE' AND Ejercicio=@YEAR and periodo=@MONTH AND cuenta in ('6100-023-002-000000')
		  group by subcuenta,cargos ) S
		  PIVOT (
		  SUM(cargos)
		  for [subcuenta] in ([14001],[14002],[14003],[14004],[14005],[14006],[14007],[14008],[14009],[14010],[14013],[14011],[14012])
		  ) P
		  ELSE
		  INSERT INTO @CONTABILIDAD VALUES (NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL)





		  /***********Mtto Mobiliario y equipo***********/
		  IF EXISTS(
		  SELECT * FROM (
		  SELECT  subcuenta, cargos
		  FROM [Madapal].[dbo].[Acum] where empresa='RODPE' AND Ejercicio=@YEAR and periodo=@MONTH AND cuenta in ('6100-023-003-000000')
		  group by subcuenta,cargos ) S
		  PIVOT (
		  SUM(cargos)
		  for [subcuenta] in ([14001],[14002],[14003],[14004],[14005],[14006],[14007],[14008],[14009],[14010],[14013],[14011],[14012])
		  ) P)
		  INSERT @CONTABILIDAD  SELECT * FROM (
		  SELECT  subcuenta, cargos
		  FROM [Madapal].[dbo].[Acum] where empresa='RODPE' AND Ejercicio=@YEAR and periodo=@MONTH AND cuenta in ('6100-023-003-000000')
		  group by subcuenta,cargos ) S
		  PIVOT (
		  SUM(cargos)
		  for [subcuenta] in ([14001],[14002],[14003],[14004],[14005],[14006],[14007],[14008],[14009],[14010],[14013],[14011],[14012])
		  ) P
		  ELSE
		  INSERT INTO @CONTABILIDAD VALUES (NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL)




		  /***********Mantenimiento plaza***********/
		  IF EXISTS (
		  SELECT * FROM (
		  SELECT  subcuenta, cargos
		  FROM [Madapal].[dbo].[Acum] where empresa='RODPE' AND Ejercicio=@YEAR and periodo=@MONTH AND cuenta in ('6100-024-000-000000')
		  group by subcuenta,cargos ) S
		  PIVOT (
		  SUM(cargos)
		  for [subcuenta] in ([14001],[14002],[14003],[14004],[14005],[14006],[14007],[14008],[14009],[14010],[14013],[14011],[14012])
		  ) P)
		  INSERT @CONTABILIDAD  SELECT * FROM (
		  SELECT  subcuenta, cargos
		  FROM [Madapal].[dbo].[Acum] where empresa='RODPE' AND Ejercicio=@YEAR and periodo=@MONTH AND cuenta in ('6100-024-000-000000')
		  group by subcuenta,cargos ) S
		  PIVOT (
		  SUM(cargos)
		  for [subcuenta] in ([14001],[14002],[14003],[14004],[14005],[14006],[14007],[14008],[14009],[14010],[14013],[14011],[14012])
		  ) P
		  ELSE
		  INSERT INTO @CONTABILIDAD VALUES (NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL)





		  /***********Cargos del Banco***********/
		  IF EXISTS (
		  SELECT * FROM (
		  SELECT  subcuenta, cargos
		  FROM [Madapal].[dbo].[Acum] where empresa='RODPE' AND Ejercicio=@YEAR and periodo=@MONTH AND cuenta in ('6100-026-000-000000')
		  group by subcuenta,cargos ) S
		  PIVOT (
		  SUM(cargos)
		  for [subcuenta] in ([14001],[14002],[14003],[14004],[14005],[14006],[14007],[14008],[14009],[14010],[14013],[14011],[14012])
		  ) P)
		  INSERT @CONTABILIDAD  SELECT * FROM (
		  SELECT  subcuenta, cargos
		  FROM [Madapal].[dbo].[Acum] where empresa='RODPE' AND Ejercicio=@YEAR and periodo=@MONTH AND cuenta in ('6100-026-000-000000')
		  group by subcuenta,cargos ) S
		  PIVOT (
		  SUM(cargos)
		  for [subcuenta] in ([14001],[14002],[14003],[14004],[14005],[14006],[14007],[14008],[14009],[14010],[14013],[14011],[14012])
		  ) P
		  ELSE
		  INSERT INTO @CONTABILIDAD VALUES (NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL)




		  /***********Mensajeria***********/
		  IF EXISTS(
		  SELECT * FROM (
		  SELECT  subcuenta, cargos
		  FROM [Madapal].[dbo].[Acum] where empresa='RODPE' AND Ejercicio=@YEAR and periodo=@MONTH AND cuenta in ('6100-029-000-000000')
		  group by subcuenta,cargos ) S
		  PIVOT (
		  SUM(cargos)
		  for [subcuenta] in ([14001],[14002],[14003],[14004],[14005],[14006],[14007],[14008],[14009],[14010],[14013],[14011],[14012])
		  ) P)
		  INSERT @CONTABILIDAD  SELECT * FROM (
		  SELECT  subcuenta, cargos
		  FROM [Madapal].[dbo].[Acum] where empresa='RODPE' AND Ejercicio=@YEAR and periodo=@MONTH AND cuenta in ('6100-029-000-000000')
		  group by subcuenta,cargos ) S
		  PIVOT (
		  SUM(cargos)
		  for [subcuenta] in ([14001],[14002],[14003],[14004],[14005],[14006],[14007],[14008],[14009],[14010],[14013],[14011],[14012])
		  ) P
		  ELSE
		  INSERT INTO @CONTABILIDAD VALUES (NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL)





		  /***********Uniforme***********/
		  IF EXISTS(
		  SELECT * FROM (
		  SELECT  subcuenta, cargos
		  FROM [Madapal].[dbo].[Acum] where empresa='RODPE' AND Ejercicio=@YEAR and periodo=@MONTH AND cuenta in ('6100-039-000-000000')
		  group by subcuenta,cargos ) S
		  PIVOT (
		  SUM(cargos)
		  for [subcuenta] in ([14001],[14002],[14003],[14004],[14005],[14006],[14007],[14008],[14009],[14010],[14013],[14011],[14012])
		  ) P)
		  INSERT @CONTABILIDAD  SELECT * FROM (
		  SELECT  subcuenta, cargos
		  FROM [Madapal].[dbo].[Acum] where empresa='RODPE' AND Ejercicio=@YEAR and periodo=@MONTH AND cuenta in ('6100-039-000-000000')
		  group by subcuenta,cargos ) S
		  PIVOT (
		  SUM(cargos)
		  for [subcuenta] in ([14001],[14002],[14003],[14004],[14005],[14006],[14007],[14008],[14009],[14010],[14013],[14011],[14012])
		  ) P
		  ELSE
		  INSERT INTO @CONTABILIDAD VALUES (NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL)

		  /***********Gastos de Viaje***********/
		  IF EXISTS(
		  SELECT * FROM (
		  SELECT  subcuenta, cargos
		  FROM [Madapal].[dbo].[Acum] where empresa='RODPE' AND Ejercicio=@YEAR and periodo=@MONTH AND cuenta in ('6100-041-000-000000')
		  group by subcuenta,cargos ) S
		  PIVOT (
		  SUM(cargos)
		  for [subcuenta] in ([14001],[14002],[14003],[14004],[14005],[14006],[14007],[14008],[14009],[14010],[14013],[14011],[14012])
		  ) P)
		  INSERT @CONTABILIDAD SELECT * FROM (
		  SELECT  subcuenta, cargos
		  FROM [Madapal].[dbo].[Acum] where empresa='RODPE' AND Ejercicio=@YEAR and periodo=@MONTH AND cuenta in ('6100-041-000-000000')
		  group by subcuenta,cargos ) S
		  PIVOT (
		  SUM(cargos)
		  for [subcuenta] in ([14001],[14002],[14003],[14004],[14005],[14006],[14007],[14008],[14009],[14010],[14013],[14011],[14012])
		  ) P
		  ELSE
		  INSERT INTO @CONTABILIDAD VALUES (NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL)


		  /***********Eventos Internos***********/
		  IF EXISTS(
		  SELECT * FROM (
		  SELECT  subcuenta, cargos
		  FROM [Madapal].[dbo].[Acum] where empresa='RODPE' AND Ejercicio=@YEAR and periodo=@MONTH AND cuenta in ('6100-042-000-000000')
		  group by subcuenta,cargos ) S
		  PIVOT (
		  SUM(cargos)
		  for [subcuenta] in ([14001],[14002],[14003],[14004],[14005],[14006],[14007],[14008],[14009],[14010],[14013],[14011],[14012])
		  ) P)
		  INSERT @CONTABILIDAD SELECT * FROM (
		  SELECT  subcuenta, cargos
		  FROM [Madapal].[dbo].[Acum] where empresa='RODPE' AND Ejercicio=@YEAR and periodo=@MONTH AND cuenta in ('6100-042-000-000000')
		  group by subcuenta,cargos ) S
		  PIVOT (
		  SUM(cargos)
		  for [subcuenta] in ([14001],[14002],[14003],[14004],[14005],[14006],[14007],[14008],[14009],[14010],[14013],[14011],[14012])
		  ) P
		  ELSE
		  INSERT INTO @CONTABILIDAD VALUES (NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL)

		  /***********Gasolina y Equipo***********/
		  IF EXISTS(
		  SELECT * FROM (
		  SELECT  subcuenta, cargos
		  FROM [Madapal].[dbo].[Acum] where empresa='RODPE' AND Ejercicio=@YEAR and periodo=@MONTH AND cuenta in ('6100-047-000-000000')
		  group by subcuenta,cargos ) S
		  PIVOT (
		  SUM(cargos)
		  for [subcuenta] in ([14001],[14002],[14003],[14004],[14005],[14006],[14007],[14008],[14009],[14010],[14013],[14011],[14012])
		  ) P)
		  INSERT @CONTABILIDAD SELECT * FROM (
		  SELECT  subcuenta, cargos
		  FROM [Madapal].[dbo].[Acum] where empresa='RODPE' AND Ejercicio=@YEAR and periodo=@MONTH AND cuenta in ('6100-047-000-000000')
		  group by subcuenta,cargos ) S
		  PIVOT (
		  SUM(cargos)
		  for [subcuenta] in ([14001],[14002],[14003],[14004],[14005],[14006],[14007],[14008],[14009],[14010],[14013],[14011],[14012])
		  ) P
		  ELSE
		  INSERT INTO @CONTABILIDAD VALUES (NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL)


		  /***********Comisiones Plataforma**********/
		  IF EXISTS(
		  SELECT * FROM (
		  SELECT  subcuenta, cargos
		  FROM [Madapal].[dbo].[Acum] where empresa='RODPE' AND Ejercicio=@YEAR and periodo=@MONTH AND cuenta in ('6100-061-000-000000')
		  group by subcuenta,cargos ) S
		  PIVOT (
		  SUM(cargos)
		  for [subcuenta] in ([14001],[14002],[14003],[14004],[14005],[14006],[14007],[14008],[14009],[14010],[14013],[14011],[14012])
		  ) P)
		  INSERT @CONTABILIDAD SELECT * FROM (
		  SELECT  subcuenta, cargos
		  FROM [Madapal].[dbo].[Acum] where empresa='RODPE' AND Ejercicio=@YEAR and periodo=@MONTH AND cuenta in ('6100-061-000-000000')
		  group by subcuenta,cargos ) S
		  PIVOT (
		  SUM(cargos)
		  for [subcuenta] in ([14001],[14002],[14003],[14004],[14005],[14006],[14007],[14008],[14009],[14010],[14013],[14011],[14012])
		  ) P
		  ELSE
		  INSERT INTO @CONTABILIDAD VALUES (NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL)



		  /***********Diversos**********/
		  IF EXISTS(
		  SELECT * FROM (
		  SELECT  subcuenta, cargos
		  FROM [Madapal].[dbo].[Acum] where empresa='RODPE' AND Ejercicio=@YEAR and periodo=@MONTH AND cuenta in ('6100-999-000-000000')
		  group by subcuenta,cargos ) S
		  PIVOT (
		  SUM(cargos)
		  for [subcuenta] in ([14001],[14002],[14003],[14004],[14005],[14006],[14007],[14008],[14009],[14010],[14013],[14011],[14012])
		  ) P)
		  INSERT @CONTABILIDAD SELECT * FROM (
		  SELECT  subcuenta, cargos
		  FROM [Madapal].[dbo].[Acum] where empresa='RODPE' AND Ejercicio=@YEAR and periodo=@MONTH AND cuenta in ('6100-999-000-000000')
		  group by subcuenta,cargos ) S
		  PIVOT (
		  SUM(cargos)
		  for [subcuenta] in ([14001],[14002],[14003],[14004],[14005],[14006],[14007],[14008],[14009],[14010],[14013],[14011],[14012])
		  ) P
		  ELSE
		  INSERT INTO @CONTABILIDAD VALUES (NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL)





		  /***********Comisiones Bancarias**********/
		  IF EXISTS(
		  SELECT * FROM (
		  SELECT  subcuenta, cargos
		  FROM [Madapal].[dbo].[Acum] where empresa='RODPE' AND Ejercicio=@YEAR and periodo=@MONTH AND cuenta in ('6200-029-001-000000')
		  group by subcuenta,cargos ) S
		  PIVOT (
		  SUM(cargos)
		  for [subcuenta] in ([14001],[14002],[14003],[14004],[14005],[14006],[14007],[14008],[14009],[14010],[14013],[14011],[14012])
		  ) P)
		  INSERT @CONTABILIDAD SELECT * FROM (
		  SELECT  subcuenta, cargos
		  FROM [Madapal].[dbo].[Acum] where empresa='RODPE' AND Ejercicio=@YEAR and periodo=@MONTH AND cuenta in ('6200-029-001-000000')
		  group by subcuenta,cargos ) S
		  PIVOT (
		  SUM(cargos)
		  for [subcuenta] in ([14001],[14002],[14003],[14004],[14005],[14006],[14007],[14008],[14009],[14010],[14013],[14011],[14012])
		  ) P
		  ELSE
		  INSERT INTO @CONTABILIDAD VALUES (NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL)

		  SELECT * FROM @CONTABILIDAD

	  </select>
	  
  </statements>
  
</sqlMap>