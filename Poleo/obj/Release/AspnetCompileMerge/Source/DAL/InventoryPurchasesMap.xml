<!--DELETE-->
<?xml version="1.0" encoding="utf-8" ?>
<sqlMap namespace="LineItem"
xmlns="http://ibatis.apache.org/mapping"
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <!--<alias>
    <typeAlias alias="InventoryPurchasesExtracts" type="Poleo.Objects.InventoryPurchasesExtracts" />
  </alias>-->
  
  <statements>
    <!--<insert id="InsertInventoryPurchases" parameterClass="InventoryPurchasesExtracts">
      
      INSERT INTO InventoryPurchasesExtracts
           ([RecordType]
           ,[DatabaseVersion]
           ,[Location_Code]
           ,[System_Date]
           ,[PurchaseID]
           ,[VendorName]
           ,[VendorCode]
           ,[InvoiceNumber]
           ,[Type]
           ,[Amount]
           ,[DeliveryCharge]
           ,[Tax])
     VALUES
     (
            #RecordType#
           ,#DatabaseVersion#
           ,#Location_Code#
           ,#System_Date#
           ,#PurchaseID#
           ,#VendorName#
           ,#VendorCode#
           ,#InvoiceNumber#
           ,#Type#
           ,#Amount#
           ,#DeliveryCharge#
           ,#Tax#
     )
    </insert>-->
  
    <select id="SelectInvoicesQtyZero" resultClass="InventoryPurchasesExtracts" parameterClass="InventoryPurchasesExtracts">
      select *
      from InventoryPurchasesExtracts IPE
      where IPE.System_Date between #System_Date# and #DateEnd# and Amount = #Amount#
    </select>

    <select id="SelectInventoryPurchasesExtractsZ" resultClass="InventoryPurchasesExtracts" parameterClass="InventoryPurchasesExtracts">
      select *
      from InventoryPurchasesExtracts IPE
      where IPE.System_Date between #System_Date# and #DateEnd# and Amount = #Amount#
    </select>
    
    <select id="SelectIPE" resultClass="InventoryPurchasesExtracts">
      select *
      from InventoryPurchasesExtracts IPE
      where IPE.System_Date between '20160229' and '20160306' and Amount = #Amount#
    </select>

    <update id="UpdateInvoicesQtyZero" parameterClass="InventoryPurchasesExtracts">
      Declare @InventoriPurchase table
      (
      Location_Code varchar(150),
      PurchaseID varchar(100)
      )

      insert into @InventoriPurchase
      select Location_Code,PurchaseID from InventoryPurchasesExtracts
      where System_Date between #System_Date# and #DateEnd# and Amount = #Amount#

      Declare @InventoriPurchaseDetail table
      (
      Location_Code varchar(150),
      PurchaseID varchar(100),
      Amount money
      )

      insert @InventoriPurchaseDetail
      select ipd.Location_Code, ipd.PurchaseID, SUM( ipd.Extended_Price) as Amount from InventoryPurchaseDetailsExtracts IPD
      inner  join @InventoriPurchase IP on IPD.Location_Code =IP.Location_Code and IPD.PurchaseID=IP.PurchaseID
      group by IPD.Location_Code, IPD.PurchaseID


      select
      ip.Location_Code AS NUMERO_TIENDA,
      ip.VendorName AS VENDEDOR_NAME,
      ip.InvoiceNumber AS NUMERO_FACTURA,
      ipd.Amount AS TOTAL_FACTURA,
      ip.System_Date AS FECHA_FACTURA
      from @InventoriPurchaseDetail ipd
      INNER JOIN  InventoryPurchasesExtracts ip ON ip.Location_Code=ipd.Location_Code AND ip.PurchaseID=ipd.PurchaseID


      update InventoryPurchasesExtracts
      set Amount=ipd.Amount
      from InventoryPurchasesExtracts ip
      inner join @InventoriPurchaseDetail ipd on ip.Location_Code=ipd.Location_Code AND ip.PurchaseID=ipd.PurchaseID
    </update>
  </statements>
</sqlMap>
