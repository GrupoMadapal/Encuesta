<?xml version="1.0" encoding="utf-8" ?>
<sqlMap namespace="LineItem"
xmlns="http://ibatis.apache.org/mapping"
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" >
  <alias>
    <typeAlias alias="InfoTiempoReal" type="Poleo.Objects.InfoTiempoReal" />
  </alias>

  <parameterMaps>
    <parameterMap id="paramMapStored" class="InfoTiempoReal">
      <parameter property="NumTienda" column="Store" />
      <parameter property="Fecha"     column="Date" />
    </parameterMap>
  </parameterMaps>

  <resultMaps>
    <resultMap id="resultMapStored" class="InfoTiempoReal">
      <result property="LoadTime" column="LoadTime" />
    </resultMap>
  </resultMaps>

  <statements>
    <select id="SelectVentasDPOnLine" resultClass="InfoTiempoReal" parameterClass="InfoTiempoReal">
      SELECT
      SUM(Importe) AS VentasReales,
      SUM(Saldo) AS VentasTotales,
      COUNT(MovID) AS Ordenes,
      FechaEmision AS Fecha
      FROM Venta V
      WHERE Empresa = 'DOT' AND FechaEmision = #Fecha# AND Mov = 'Nota'
      <iterate prepend=" AND V.Sucursal IN " property="LstNumTienda" open="(" close=")" conjunction=",">
        #LstNumTienda[]#
      </iterate>
      GROUP BY FechaEmision
    </select>

    <select id="SelectVentasDPOnLineTienda" resultClass="InfoTiempoReal" parameterClass="InfoTiempoReal">
      SELECT
      SUM(Importe) AS VentasReales,
      SUM(Saldo) AS VentasTotales,
      COUNT(MovID) AS Ordenes,
      CAST(V.Sucursal AS VARCHAR(6)) AS NumTienda,
      S.Nombre AS NombreTienda,
      V.FechaEmision AS Fecha
      FROM Venta V
      INNER JOIN Sucursal S ON V.Sucursal = S.Sucursal
      WHERE Empresa = 'DOT' AND FechaEmision = #Fecha# AND Mov = 'Nota'
      <iterate prepend=" AND V.Sucursal IN " property="LstNumTienda" open="(" close=")" conjunction=",">
        #LstNumTienda[]#
      </iterate>
      GROUP BY V.Sucursal, S.Nombre, V.FechaEmision
    </select>

    <procedure ID="GetEntradaHornoStore" resultMap="resultMapStored" parameterMap="paramMapStored">
      spGetLoadTimeByStore
    </procedure>

    <procedure ID="GetLoadEstimatedDeliveryTime" resultClass="decimal" parameterMap="paramMapStored">
      spGetLoadEstimatedDeliveryTime
    </procedure>
  
    <!--<procedure ID="GetFreeOrders" resultClass="InfoTiempoReal" parameterMap="paramMapStored">-->
    <procedure ID="GetFreeOrders" resultClass="int" parameterMap="paramMapStored">
      spGetFreeOrders
    </procedure>

    <!--<procedure ID="GetGetOrdersCancel" resultClass="InfoTiempoReal" parameterMap="paramMapStored">-->
    <procedure ID="GetGetCancelOrders" resultClass="int" parameterMap="paramMapStored">
      spGetOrdersCancel
    </procedure>

    <!--Added by Hector Sanchez M. - 20171114-->
    <procedure ID="GetTotalDeposit" resultClass="decimal?" parameterMap="paramMapStored">
      spGetTotalDeposit
    </procedure>
  </statements>
</sqlMap>
